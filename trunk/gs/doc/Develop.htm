<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Information for Ghostscript developers</title>
<link rel="stylesheet" type="text/css" href="gs.css" title="Ghostscript Style">
<!-- $Id$ -->
</head>

<body>
<!-- [1.0 begin visible header] ============================================ -->

<!-- [1.1 begin headline] ================================================== -->

<h1>Information for Ghostscript developers</h1>

<!-- [1.1 end headline] ==================================================== -->

<!-- [1.2 begin table of contents] ========================================= -->

<h2>Table of contents</h2>

<blockquote><ul>
<li><a href="#Introduction">Introduction</a>
<li><a href="#Architecture">Architecture</a>
<ul>
<li><a href="#Design_goals">Design goals</a>
<li><a href="#Large_scale_structure">Large-scale structure</a>
<li><a href="#Object_oriented_constructs">Object-oriented constructs</a>
</ul>
<li><a href="#File_roadmap">File roadmap</a>
<ul>
<li><a href="#Substrate">Substrate</a>
<li><a href="#Graphics_library">Graphics library</a>
<ul>
<li><a href="#Library_support">Support</a>,
    <a href="#Paths">Paths</a>,
    <a href="#Text">Text</a>,
    <a href="#Images">Images</a>,
    <a href="#Paint">Paint</a>,
    <a href="#Other_graphics">Other_graphics</a>,
    <a href="#Driver_support">Driver support</a>
</ul>
<li><a href="#Device_drivers">Device drivers</a>
<ul>
<li><a href="#Internal_devices">Internal devices</a>,
    <a href="#High_level_devices">High-level devices</a>,
    <a href="#Other_maintained_drivers">Other maintained drivers</a>,
    <a href="#Contributed_drivers">Contributed drivers</a>
</ul>
<li><a href="#PostScript_interpreter">PostScript interpreter</a>
<ul>
<li><a href="#Main_program">Main program</a>,
    <a href="#PostScript_interpreter_support">Support</a>,
    <a href="#Scanning_parsing">Scanning/parsing</a>,
    <a href="#Standard_operators">Standard operators</a>,
    <a href="#Non_standard_operators">Non-standard operators</a>,
    <a href="#PostScript_code">PostScript code</a>
</ul>
<li><a href="#PDF_interpreter">PDF interpreter</a>
<li><a href="#Build_support">Build support</a>
<li><a href="#Utilities">Utilities</a>
<ul>
<li><a href="#Utilities_in_PostScript">Utilities in PostScript</a>
<li><a href="#Utility_scripts">Utility scripts</a>
</ul>
</ul>
<li><a href="#Memory_management">Memory management</a>
<ul>
<li><a href="#Memory_manager_architecture">Memory manager architecture</a>
<ul>
<li><a href="#Objects_vs_strings">Objects vs strings</a>,
    <a href="#Structure_descriptors">Structure descriptors</a>,
    <a href="#Garbage_collection">Garbage collection</a>,
    <a href="#Movability">Movability</a>,
    <a href="#Parent_hierarchy">Parent hierarchy</a>,
    <a href="#Allocator_API">Allocator API</a>
</ul>
<li><a href="#Freeing_storage">Freeing storage</a>
<ul>
<li><a href="#Explicit_freeing">Explicit freeing</a>,
    <a href="#Reference_counting">Reference counting</a>,
    <a href="#Real_garbage_collection">(Real) garbage collection</a>
</ul>
<li><a href="#Special_implementations">Special implementations</a>
<ul>
<li><a href="#malloc">malloc</a>,
    <a href="#Locking">Locking</a>,
    <a href="#Retrying">Retrying</a>
</ul>
<li><a href="#Standard_implementation">Standard implementation</a>
<li><a href="#PostScript_interpreter_extensions">PostScript interpreter extensions</a>
<ul>
<li><a href="#Refs">Refs (PostScript "objects")</a>,
    <a href="#save_forgetsave_restore">save/.forgetsave/restore</a>,
    <a href="#Stable_allocators">Stable allocators</a>,
    <a href="#Interpreter_GC">Garbage collection</a>
</ul>
</ul>
<li><a href="#Portability">Portability</a>
<ul>
<li><a href="#Structural">Structural</a>
<ul>
<li><a href="#CPU_and_compiler">CPU and compiler</a>,
    <a href="#Library_headers">Library headers</a>,
    <a href="#Cross_platform_APIs">Cross-platform APIs</a>,
    <a href="#Makefiles">Makefiles</a>
</ul>
<li><a href="#Coding">Coding</a>
<ul>
<li><a href="#Explicit_dependencies">Explicit dependencies</a>,
    <a href="#Implicit_dependencies">Implicit dependencies</a>
</ul>
<li><a href="#Platform_specific_code">Platform-specific code</a>
</ul>
<li><a href="#Adding_features_and_options">Adding features and options</a>
<li><a href="#Troubleshooting">Troubleshooting</a>
</ul></blockquote>

<!-- [1.2 end table of contents] =========================================== -->

<!-- [1.3 begin hint] ====================================================== -->

<p>For other information, see the <a href="Readme.htm">Ghostscript
overview</a> and the documentation related to <a
href="Maintain.htm">maintaining Ghostscript</a>.

<!-- [1.3 end hint] ======================================================== -->

<hr>

<!-- [1.0 end visible header] ============================================== -->

<!-- [2.0 begin contents] ================================================== -->

<h2><a name="Introduction"></a>Introduction</h2>

<p>
This document provides a wealth of information about Ghostscript's
internals, primarily for developers actively working on Ghostscript.

<p>
THIS FILE IS A WORK IN PROGRESS.  MANY SECTIONS ARE PLACE-HOLDERS.

<h2><a name="Architecture"></a>Architecture</h2>

<h2><a name="Design_goals"></a>Design goals</h2>

<p>
Ghostscript has the following high-level design goals (not listed in order
of importance):

<ul>
<li>Functionality
<ul>
<li>Ability to interpret the current PostScript and PDF languages, as
defined (and occasionally, in the case of conflict, as implemented) by
Adobe.
<li>Ability to convert PostScript to and from PDF, comparable to
Adobe products.
<li>Ability to produce output for a wide range of resolutions (from
TV-resolution displays to imagesetters) and color models (black and white,
multilevel gray, bilevel or multi-level RGB and CMYK, 6- or 8-color
inkjet printers, spot color).
</ul>
<li>Performance
<ul>
<li>Ability to render PostScript and PDF with commercial-quality performance
(memory usage, speed, and output quality) on all platforms.
<li>Specifically, ability to render PostScript effectively in embedded
environments with constrained RAM, including the ability to put the code and
supporting data in ROM.
</ul>
<li>Licensing
<ul>
<li>Licensing that supports both the Open Source / Free software communities
and a commercial licensing business.
<li>Freedom from licensing restrictions or fees imposed by third parties.
</ul>
<li>Other
<ul>
<li>Easy source portability to any platform (CPU, operating system, and
development tools) that has an ANSI or K&amp;R C compiler.
<li>Support for writing new interpreters and new drivers with no change to
any existing code; specifically, ability to support PCL 5e, PCL 5c, and PCL
XL interpreters, and the ever-changing roster of inkjet printers.
</ul>
</ul>

<p>
These goals often conflict: part of Ghostscript's claim to quality is that
the conflicts have been resolved well.

<h3><a name="Large_scale_structure"></a>Large-scale structure</h3>

<p>
At the largest design scale, Ghostscript consists of 4 layers.  Layer N
is allowed to use the facilities of all layers M &lt;= N.

<ol>

<li>The bottom layer is called the <a href="#Substrate">substrate</a>.  It
includes facilities like memory management, streams, fixed-point arithmetic,
and low-level interfaces to the operating system.  The substrate is written
in C, with a little C++ and/or assembler code for some platforms.

<li>The layer above the substrate is the graphics layer.  It consists of two
separate sub-parts.  The graphics layer is written in C.

<ul>

<li>The <a href="#Graphics_library">graphics library</a> manages graphics
state information for, and decomposes and renders 2-D images described
using, a graphics model that is approximately the union of those of
PostScript, PDF, and PCL 5e/5c/XL.

<li>The <a href="#Device_drivers">device drivers</a> are called by the
graphics library to produce actual output.  The graphics library, and all
higher layers, call device driver procedures only through virtual functions.

</ul>

<li>The principal clients of the graphics layer are language interpreters.
Ghostscript as distributed includes the <a
href="#PostScript_interpreter">PostScript interpreter</a>; there are also
interpreters for PCL 5e, PCL 5c, and PCL XL, which are not currently freely
redistributable and are not included in the standard Ghostscript package.
The PostScript interpreter is written partly in C and partly in PostScript.

<li>The <a href="#PDF_interpreter">PDF interpreter</a> is actually a client
of the PostScript interpreter: it is written entirely in PostScript.

</ol>

<p>
The most important interface in Ghostscript is the API between the graphics
library and the device drivers: new printers (and, to a lesser extent,
window systems, displays, plotters, film recorders, and graphics file
formats) come on the scene frequently, and it must be possible to produce
output for them with a minimum of effort and distruption.  This API is the
only one that is extensively documented (see <a
href="Drivers.htm">Drivers.htm</a>) and kept stringently backward-compatible
through successive releases.

<h3><a name="Object_oriented_constructs"></a>Object-oriented constructs</h3>

<hr>

<h2><a name="File_roadmap"></a>File roadmap</h2>

<p>
This section of the document provides a roadmap to all of the Ghostscript
source files.

<h3><a name="Substrate"></a>Substrate</h3>

<h3>Memory manager</h3>

<p>
See <a href="#Memory_management">below</a>.

<h3>Streams</h3>

<dl>

<dt>
Framework, file and string streams:
<dd>
<a href="../src/gsdsrc.c">src/gsdsrc.c</a>,
<a href="../src/gsdsrc.h">src/gsdsrc.h</a>,
<a href="../src/scommon.h">src/scommon.h</a>,
<a href="../src/sfxboth.c">src/sfxboth.c</a>,
<a href="../src/sfxfd.c">src/sfxfd.c</a>,
<a href="../src/sfxstdio.c">src/sfxstdio.c</a>,
<a href="../src/stream.h">src/stream.h</a>,
<a href="../src/stream.c">src/stream.c</a>,
<a href="../src/strimpl.h">src/strimpl.h</a>.

<dt>
Standard filters:
<dd>
<a href="../src/gsjconf.h">src/gsjconf.h</a>,
<a href="../src/gsjmorec.h">src/gsjmorec.h</a>,
<a href="../src/sa85d.c">src/sa85d.c</a>,
<a href="../src/sa85d.h">src/sa85d.h</a>,
<a href="../src/sa85x.h">src/sa85x.h</a>,
<a href="../src/scf.h">src/scf.h</a>,
<a href="../src/scfd.c">src/scfd.c</a>,
<a href="../src/scfdgen.c">src/scfdgen.c</a>,
<a href="../src/scfdtab.c">src/scfdtab.c</a>,
<a href="../src/scfe.c">src/scfe.c</a>,
<a href="../src/scfetab.c">src/scfetab.c</a>,
<a href="../src/scfparam.c">src/scfparam.c</a>,
<a href="../src/scfx.h">src/scfx.h</a>,
<a href="../src/sdcparam.c">src/sdcparam.c</a>,
<a href="../src/sdcparam.h">src/sdcparam.h</a>,
<a href="../src/sdct.h">src/sdct.h</a>,
<a href="../src/sdctc.c">src/sdctc.c</a>,
<a href="../src/sdctd.c">src/sdctd.c</a>,
<a href="../src/sdcte.c">src/sdcte.c</a>,
<a href="../src/sddparam.c">src/sddparam.c</a>,
<a href="../src/sdeparam.c">src/sdeparam.c</a>,
<a href="../src/sfilter1.c">src/sfilter1.c</a>,
<a href="../src/sfilter2.c">src/sfilter2.c</a>,
<a href="../src/sjpeg.h">src/sjpeg.h</a>,
<a href="../src/sjpegc.c">src/sjpegc.c</a>,
<a href="../src/sjpegd.c">src/sjpegd.c</a>,
<a href="../src/sjpege.c">src/sjpege.c</a>,
<a href="../src/slzwc.c">src/slzwc.c</a>,
<a href="../src/slzwce.c">src/slzwce.c</a>,
<a href="../src/slzwd.c">src/slzwd.c</a>,
<a href="../src/slzwx.h">src/slzwx.h</a>,
<a href="../src/srld.c">src/srld.c</a>,
<a href="../src/srle.c">src/srle.c</a>,
<a href="../src/srlx.h">src/srlx.h</a>,
<a href="../src/sstring.c">src/sstring.c</a>,
<a href="../src/sstring.h">src/sstring.h</a>.

<dt>
Non-standard filters used to implement standard filters:
<dd>
<a href="../src/seexec.c">src/seexec.c</a>,
<a href="../src/sfilter.h">src/sfilter.h</a>,
<a href="../src/shc.c">src/shc.c</a>,
<a href="../src/shc.h">src/shc.h</a>,
<a href="../src/shcgen.c">src/shcgen.c</a>,
<a href="../src/shcgen.h">src/shcgen.h</a>,
<a href="../src/spdiff.c">src/spdiff.c</a>,
<a href="../src/spdiffx.h">src/spdiffx.h</a>,
<a href="../src/spngp.c">src/spngp.c</a>,
<a href="../src/spngpx.h">src/spngpx.h</a>,
<a href="../src/szlibc.c">src/szlibc.c</a>,
<a href="../src/szlibd.c">src/szlibd.c</a>,
<a href="../src/szlibe.c">src/szlibe.c</a>,
<a href="../src/szlibx.h">src/szlibx.h</a>,
<a href="../src/szlibxx.h">src/szlibxx.h</a>.

<dt>
Non-standard filters:
<dd>
<a href="../src/sbcp.c">src/sbcp.c</a>,
<a href="../src/sbcp.h">src/sbcp.h</a>,
<a href="../src/sbhc.c">src/sbhc.c</a>,
<a href="../src/sbhc.h">src/sbhc.h</a>,
<a href="../src/sbtx.h">src/sbtx.h</a>,
<a href="../src/sbwbs.c">src/sbwbs.c</a>,
<a href="../src/sbwbs.h">src/sbwbs.h</a>,
<a href="../src/smd5.c">src/smd5.c</a>,
<a href="../src/smd5.h">src/smd5.h</a>,
<a href="../src/smtf.c">src/smtf.c</a>,
<a href="../src/smtf.h">src/smtf.h</a>.

<dt>
Internal filters:
<dd>
a<a href="../src/siinterp.c">src/siinterp.c</a>,
<a href="../src/siinterp.h">src/siinterp.h</a>,
<a href="../src/siscale.c">src/siscale.c</a>,
<a href="../src/siscale.h">src/siscale.h</a>,
<a href="../src/sisparam.h">src/sisparam.h</a>.

<dt>
Higher-level stream support:
<dd>
<a href="../src/spprint.c">src/spprint.c</a>,
<a href="../src/spprint.h">src/spprint.h</a>,
<a href="../src/spsdf.c">src/spsdf.c</a>,
<a href="../src/spsdf.h">src/spsdf.h</a>,
<a href="../src/srdline.h">src/srdline.h</a>.

</dl>

<h3>Platform-specific code</h3>

See <a href="#Cross_platform_APIs">below</a>.

<h3>Miscellaneous</h3>

<dl>

<dt>
Library top level:
<dd>
<a href="../src/gsinit.c">src/gsinit.c</a>,
<a href="../src/gslib.h">src/gslib.h</a>.

<dt>
Configuration-related:
<dd>
<a href="../src/gconf.c">src/gconf.c</a>,
<a href="../src/gconf.h">src/gconf.h</a>,
<a href="../src/gscdef.c">src/gscdef.c</a>,
<a href="../src/gscdefs.h">src/gscdefs.h</a>.

<dt>
Arithmetic:
<dd>
<a href="../src/gsfemu.c">src/gsfemu.c</a>,
<a href="../src/gxarith.h">src/gxarith.h</a>,
<a href="../src/gxdda.h">src/gxdda.h</a>,
<a href="../src/gxfarith.h">src/gxfarith.h</a>,
<a href="../src/gxfixed.h">src/gxfixed.h</a>,
<a href="../src/gxfrac.h">src/gxfrac.h</a>.

<dt>
Operating system interface:
<dd>
<a href="../src/gserror.h">src/gserror.h</a>,
<a href="../src/gsexit.h">src/gsexit.h</a>,
<a href="../src/gxstdio.h">src/gxstdio.h</a>,
<a href="../src/gxsync.c">src/gxsync.c</a>,
<a href="../src/gxsync.h">src/gxsync.h</a>.

<dt>
Other:
<dd>
<a href="../src/gsargs.c">src/gsargs.c</a>,
<a href="../src/gsargs.h">src/gsargs.h</a>,
<a href="../src/gserrors.h">src/gserrors.h</a>,
<a href="../src/gsnotify.c">src/gsnotify.c</a>,
<a href="../src/gsnotify.h">src/gsnotify.h</a>,
<a href="../src/gsrect.h">src/gsrect.h</a>,
<a href="../src/gstypes.h">src/gstypes.h</a>,
<a href="../src/gsuid.h">src/gsuid.h</a>,
<a href="../src/gsutil.h">src/gsutil.h</a>,
<a href="../src/gsutil.c">src/gsutil.c</a>,
<a href="../src/gx.h">src/gx.h</a>,
<a href="../src/md5.c">src/md5.c</a>,
<a href="../src/md5.h">src/md5.h</a>.

</dl>

<h3><a name="Graphics_library"></a>Graphics library</h3>

<h4><a name="Library_support"></a>Support</h4>

<dl>

<dt>
Bitmap processing:
<dd>
<a href="../src/gsbitmap.h">src/gsbitmap.h</a>,
<a href="../src/gsbitops.c">src/gsbitops.c</a>,
<a href="../src/gsbitops.h">src/gsbitops.h</a>,
<a href="../src/gsbittab.c">src/gsbittab.c</a>,
<a href="../src/gsbittab.h">src/gsbittab.h</a>,
<a href="../src/gsflip.c">src/gsflip.c</a>,
<a href="../src/gsflip.h">src/gsflip.h</a>,
<a href="../src/gxbitmap.h">src/gxbitmap.h</a>,
<a href="../src/gxbitops.h">src/gxbitops.h</a>,
<a href="../src/gxsample.c">src/gxsample.c</a>,
<a href="../src/gxsample.h">src/gxsample.h</a>.

<dt>
Functions:
<dd>
<a href="../src/gsfunc.c">src/gsfunc.c</a>,
<a href="../src/gsfunc.h">src/gsfunc.h</a>,
<a href="../src/gsfunc0.c">src/gsfunc0.c</a>,
<a href="../src/gsfunc0.h">src/gsfunc0.h</a>,
<a href="../src/gsfunc3.c">src/gsfunc3.c</a>,
<a href="../src/gsfunc3.h">src/gsfunc3.h</a>,
<a href="../src/gsfunc4.c">src/gsfunc4.c</a>,
<a href="../src/gsfunc4.h">src/gsfunc4.h</a>,
<a href="../src/gsfuncv.c">src/gsfuncv.c</a>,
<a href="../src/gsfuncv.h">src/gsfuncv.h</a>,
<a href="../src/gxfunc.h">src/gxfunc.h</a>.

<dt>
Parameter lists:
<dd>
<a href="../src/gscparam.c">src/gscparam.c</a>,
<a href="../src/gsparam.c">src/gsparam.c</a>,
<a href="../src/gsparam.h">src/gsparam.h</a>,
<a href="../src/gsparam2.c">src/gsparam2.c</a> (not used),
<a href="../src/gsparams.c">src/gsparams.c</a>,
<a href="../src/gsparams.h">src/gsparams.h</a>,
<a href="../src/gsparamx.c">src/gsparamx.c</a>,
<a href="../src/gsparamx.h">src/gsparamx.h</a>.

<dt>
I/O-related:
<dd>
<a href="../src/gdevpipe.c">src/gdevpipe.c</a>,
<a href="../src/gsfname.c">src/gsfname.c</a>,
<a href="../src/gsfname.h">src/gsfname.h</a>,
<a href="../src/gsio.h">src/gsio.h</a>,
<a href="../src/gsiodev.c">src/gsiodev.c</a>,
<a href="../src/gsiodevs.c">src/gsiodevs.c</a>,
<a href="../src/gxiodev.h">src/gxiodev.h</a>.

</dl>

<h4><a name="Paths"></a>Paths</h4>

<dl>

<dt>
Coordinate transformation:
<dd>
<a href="../src/gscoord.c">src/gscoord.c</a>,
<a href="../src/gscoord.h">src/gscoord.h</a>,
<a href="../src/gsmatrix.c">src/gsmatrix.c</a>,
<a href="../src/gsmatrix.h">src/gsmatrix.h</a>,
<a href="../src/gxcoord.h">src/gxcoord.h</a>,
<a href="../src/gxmatrix.h">src/gxmatrix.h</a>.

<dt>
Path building:
<dd>
<a href="../src/gsdps1.c">src/gsdps1.c</a>,
<a href="../src/gspath.c">src/gspath.c</a>,
<a href="../src/gspath.h">src/gspath.h</a>,
<a href="../src/gspath1.c">src/gspath1.c</a>,
<a href="../src/gspath2.h">src/gspath2.h</a>,
<a href="../src/gxpath.c">src/gxpath.c</a>,
<a href="../src/gxpath.h">src/gxpath.h</a>,
<a href="../src/gxpath2.c">src/gxpath2.c</a>,
<a href="../src/gxpcopy.c">src/gxpcopy.c</a>,
<a href="../src/gxpdash.c">src/gxpdash.c</a>,
<a href="../src/gxpflat.c">src/gxpflat.c</a>,
<a href="../src/gzpath.h">src/gzpath.h</a>.

<dt>
Path rendering:
<dd>
<a href="../src/gdevddrw.c">src/gdevddrw.c</a>,
<a href="../src/gsdps1.c">src/gsdps1.c</a>,
<a href="../src/gspaint.c">src/gspaint.c</a>,
<a href="../src/gspaint.h">src/gspaint.h</a>,
<a href="../src/gspenum.h">src/gspenum.h</a>,
<a href="../src/gxfill.c">src/gxfill.c</a>,
<a href="../src/gxpaint.c">src/gxpaint.c</a>,
<a href="../src/gxpaint.h">src/gxpaint.h</a>,
<a href="../src/gxstroke.c">src/gxstroke.c</a>.

<dt>
Clipping:
<dd>
<a href="../src/gxcpath.c">src/gxcpath.c</a>,
<a href="../src/gxcpath.h">src/gxcpath.h</a>,
<a href="../src/gzcpath.h">src/gzcpath.h</a>.

</dl>

<h4><a name="Text"></a>Text</h4>

<dl>

<dt>
Fonts, generic:
<dd>
<a href="../src/gsfont.c">src/gsfont.c</a>,
<a href="../src/gsfont.h">src/gsfont.h</a>,
<a href="../src/gxfont.h">src/gxfont.h</a>.

<dt>
Fonts, specific FontTypes:
<dd>
<a href="../src/gsfcid.c">src/gsfcid.c</a>,
<a href="../src/gsfcmap.c">src/gsfcmap.c</a>,
<a href="../src/gsfcmap.h">src/gsfcmap.h</a>,
<a href="../src/gsfont0.c">src/gsfont0.c</a>,
<a href="../src/gxcid.h">src/gxcid.h</a>,
<a href="../src/gxfcid.h">src/gxfcid.h</a>,
<a href="../src/gxfcmap.h">src/gxfcmap.h</a>,
<a href="../src/gxfont0.h">src/gxfont0.h</a>,
<a href="../src/gxfont1.h">src/gxfont1.h</a>,
<a href="../src/gxfont42.h">src/gxfont42.h</a>,
<a href="../src/gxftype.h">src/gxftype.h</a>,
<a href="../src/gxttf.h">src/gxttf.h</a>.

<dt>
Character rendering + font cache, generic:
<dd>
<a href="../src/gsccode.h">src/gsccode.h</a>,
<a href="../src/gschar.c">src/gschar.c</a>,
<a href="../src/gschar.h">src/gschar.h</a>,
<a href="../src/gscpm.h">src/gscpm.h</a>,
<a href="../src/gstext.c">src/gstext.c</a>,
<a href="../src/gstext.h">src/gstext.h</a>,
<a href="../src/gxbcache.c">src/gxbcache.c</a>,
<a href="../src/gxbcache.h">src/gxbcache.h</a>,
<a href="../src/gxccache.c">src/gxccache.c</a>,
<a href="../src/gxccman.c">src/gxccman.c</a>,
<a href="../src/gxchar.c">src/gxchar.c</a>,
<a href="../src/gxchar.h">src/gxchar.h</a>,
<a href="../src/gxfcache.h">src/gxfcache.h</a>,
<a href="../src/gxtext.h">src/gxtext.h</a>.

<dt>
Character rendering, specific FontTypes:
<dd>
<a href="../src/gschar0.c">src/gschar0.c</a>,
<a href="../src/gscrypt1.c">src/gscrypt1.c</a>,
<a href="../src/gscrypt1.h">src/gscrypt1.h</a>,
<a href="../src/gstype1.c">src/gstype1.c</a>,
<a href="../src/gstype1.h">src/gstype1.h</a>,
<a href="../src/gstype2.c">src/gstype2.c</a>,
<a href="../src/gstype42.c">src/gstype42.c</a>,
<a href="../src/gxchrout.c">src/gxchrout.c</a>,
<a href="../src/gxchrout.h">src/gxchrout.h</a>,
<a href="../src/gxhint1.c">src/gxhint1.c</a>,
<a href="../src/gxhint2.c">src/gxhint2.c</a>,
<a href="../src/gxhint3.c">src/gxhint3.c</a>,
<a href="../src/gxop1.h">src/gxop1.h</a>,
<a href="../src/gxtype1.c">src/gxtype1.c</a>,
<a href="../src/gxtype1.h">src/gxtype1.h</a>.

</dl>

<h4><a name="Images"></a>Images</h4>

<dl>

<dt>
Images:
<dd>
<a href="../src/gsimage.c">src/gsimage.c</a>,
<a href="../src/gsimage.h">src/gsimage.h</a>,
<a href="../src/gsimpath.c">src/gsimpath.c</a>,
<a href="../src/gsipar3x.h">src/gsipar3x.h</a>,
<a href="../src/gsiparam.h">src/gsiparam.h</a>,
<a href="../src/gsiparm2.h">src/gsiparm2.h</a>,
<a href="../src/gsiparm3.h">src/gsiparm3.h</a>,
<a href="../src/gsiparm4.h">src/gsiparm4.h</a>,
<a href="../src/gxi12bit.c">src/gxi12bit.c</a>,
<a href="../src/gxiclass.h">src/gxiclass.h</a>,
<a href="../src/gxicolor.c">src/gxicolor.c</a>,
<a href="../src/gxidata.c">src/gxidata.c</a>,
<a href="../src/gxifast.c">src/gxifast.c</a>,
<a href="../src/gximag3x.c">src/gximag3x.c</a>,
<a href="../src/gximag3x.h">src/gximag3x.h</a>,
<a href="../src/gximage.c">src/gximage.c</a>,
<a href="../src/gximage.h">src/gximage.h</a>,
<a href="../src/gximage1.c">src/gximage1.c</a>,
<a href="../src/gximage2.c">src/gximage2.c</a>,
<a href="../src/gximage3.c">src/gximage3.c</a>,
<a href="../src/gximage3.h">src/gximage3.h</a>,
<a href="../src/gximage4.c">src/gximage4.c</a>,
<a href="../src/gximono.c">src/gximono.c</a>,
<a href="../src/gxino12b.c">src/gxino12b.c</a>,
<a href="../src/gxiparam.h">src/gxiparam.h</a>,
<a href="../src/gxipixel.c">src/gxipixel.c</a>,
<a href="../src/gxiscale.c">src/gxiscale.c</a>.

</dl>

<h4><a name="Paint"></a>Paint</h4>

<p>
Ghostscript uses 4 internal representations of color.  We list them here in
the order in which they occur in the rendering pipeline.

<ol>

<li>Clients of the graphics library normally specify colors using the
<em>client color</em> structure (<b><tt>gs_client_color</tt></b>, defined in
<a href="../src/gsccolor.h">src/gsccolor.h</a>).  This corresponds directly
to the values that would be passed to the PostScript
<b><tt>setcolor</tt></b> operator: one or more (floating-point) numeric
components and/or a Pattern.  The associated color space is implicit (in the
graphics state).

<li>For ordinary non-Pattern colors, the first step in color rendering is to
reduce a client color to a <em>concrete</em> color -- a set of values in the
device's color model (except for possible conversions between DeviceGray,
DeviceRGB, and DeviceCMYK).  Concrete colors are represented by arrays of
<b><tt>frac</tt></b> values, defined in <a
href="../src/gxfrac.h">src/gxfrac.h</a>.  The color space is implicit in the
control flow.  The procedure for this step is a virtual procedure in the
color space.

<li>The result of finishing mapping a concrete color to the device's color
mode, followed by halftoning if necessary, is called (inappropriately) a
<em>device color</em> (<b><tt>gx_device_color</tt></b>, defined in <a
href="../src/gsdcolor.h">src/gsdcolor.h</a> and <a
href="../src/gxdcolor.h">src/gxdcolor.h</a>).  For ordinary non-Pattern
colors, a device color is either a pure color, a binary halftone (single
plane, single bit, with a 2-color palette) halftone, or a multi-plane
halftone.  The device and color model associated with a device color are
implicit.  The procedure for this step is also a virtual procedure in the
color space.

<li>The pure colors that underlie a device color are opaque <em>pixel
values</em> defined by the device (misnamed <b><tt>gx_color_index</tt></b>,
defined in <a href="../src/gscindex.h">src/gscindex.h</a>).  The device and
color model are implicit.  Virtual procedures of the device driver map
between pixel values and RGB or CMYK.  (This area is untidy and will need to
be cleaned up when we implement real Separation and DeviceN colors.)

</ol>

<p>
Steps 2 and 3 are normally combined into a single step for efficiency.

<p>
Using a device color to actually paint pixels requires a further step called
<em>color loading</em>.  This does nothing for pure colors, but loads the
caches for halftones.  Color loading is a virtual procedure in the device
color.

<p>
All of the above steps -- concretizing, mapping to a device color, and color
loading -- are done as late as possible, normally not until the color is
actually needed for painting.

<p>
All painting operations (fill, stroke, imagemask) eventually call a virtual
procedure in the device color, either <b><tt>fill_rectangle</tt></b> or
<b><tt>fill_mask</tt></b> to actually paint pixels.

<dl>

<dt>
Color specification:
<dd>
<a href="../src/gsccolor.h">src/gsccolor.h</a>,
<a href="../src/gscolor.c">src/gscolor.c</a>,
<a href="../src/gscolor.h">src/gscolor.h</a>,
<a href="../src/gscolor1.c">src/gscolor1.c</a>,
<a href="../src/gscolor1.h">src/gscolor1.h</a>,
<a href="../src/gscolor2.c">src/gscolor2.c</a>,
<a href="../src/gscolor2.h">src/gscolor2.h</a>,
<a href="../src/gscolor3.c">src/gscolor3.c</a>,
<a href="../src/gscolor3.h">src/gscolor3.h</a>,
<a href="../src/gshsb.c">src/gshsb.c</a>,
<a href="../src/gshsb.h">src/gshsb.h</a>,
<a href="../src/gxcolor2.h">src/gxcolor2.h</a>,
<a href="../src/gxcvalue.h">src/gxcvalue.h</a>.

<dt>
Color spaces:
<dd>
<a href="../src/gscdevn.c">src/gscdevn.c</a>,
<a href="../src/gscdevn.h">src/gscdevn.h</a>,
<a href="../src/gscie.c">src/gscie.c</a>,
<a href="../src/gscie.h">src/gscie.h</a>,
<a href="../src/gscpixel.c">src/gscpixel.c</a>,
<a href="../src/gscpixel.h">src/gscpixel.h</a>,
<a href="../src/gscscie.c">src/gscscie.c</a>,
<a href="../src/gscsepnm.h">src/gscsepnm.h</a>,
<a href="../src/gscsepr.c">src/gscsepr.c</a>,
<a href="../src/gscsepr.h">src/gscsepr.h</a>,
<a href="../src/gscspace.c">src/gscspace.c</a>,
<a href="../src/gscspace.h">src/gscspace.h</a>,
<a href="../src/gscssub.c">src/gscssub.c</a>,
<a href="../src/gscssub.h">src/gscssub.h</a>,
<a href="../src/gxcdevn.h">src/gxcdevn.h</a>,
<a href="../src/gxcie.h">src/gxcie.h</a>,
<a href="../src/gxcspace.h">src/gxcspace.h</a>.

<dt>
Color mapping:
<dd>
<a href="../src/gsciemap.c">src/gsciemap.c</a>,
<a href="../src/gscindex.h">src/gscindex.h</a>,
<a href="../src/gscrd.c">src/gscrd.c</a>,
<a href="../src/gscrd.h">src/gscrd.h</a>,
<a href="../src/gscrdp.c">src/gscrdp.c</a>,
<a href="../src/gscrdp.h">src/gscrdp.h</a>,
<a href="../src/gscsel.h">src/gscsel.h</a>,
<a href="../src/gsdcolor.h">src/gsdcolor.h</a>,
<a href="../src/gxcindex.h">src/gxcindex.h</a>,
<a href="../src/gxcmap.c">src/gxcmap.c</a>,
<a href="../src/gxcmap.h">src/gxcmap.h</a>,
<a href="../src/gxctable.c">src/gxctable.c</a>,
<a href="../src/gxctable.h">src/gxctable.h</a>,
<a href="../src/gxdcconv.c">src/gxdcconv.c</a>,
<a href="../src/gxdcconv.h">src/gxdcconv.h</a>,
<a href="../src/gxdcolor.c">src/gxdcolor.c</a>,
<a href="../src/gxdcolor.h">src/gxdcolor.h</a>,
<a href="../src/gxdither.c">src/gxdither.c</a>,
<a href="../src/gxdither.h">src/gxdither.h</a>,
<a href="../src/gxfmap.h">src/gxfmap.h</a>,
<a href="../src/gxlum.h">src/gxlum.h</a>,
<a href="../src/gxtmap.h">src/gxtmap.h</a>.

<dt>
Halftoning:
<dd>
<a href="../src/gsht.c">src/gsht.c</a>,
<a href="../src/gsht.h">src/gsht.h</a>,
<a href="../src/gsht1.c">src/gsht1.c</a>,
<a href="../src/gsht1.h">src/gsht1.h</a>,
<a href="../src/gshtscr.c">src/gshtscr.c</a>,
<a href="../src/gshtx.c">src/gshtx.c</a>,
<a href="../src/gshtx.h">src/gshtx.h</a>,
<a href="../src/gxcht.c">src/gxcht.c</a>,
<a href="../src/gxdht.h">src/gxdht.h</a>,
<a href="../src/gxdhtres.h">src/gxdhtres.h</a>,
<a href="../src/gxht.c">src/gxht.c</a>,
<a href="../src/gxht.h">src/gxht.h</a>,
<a href="../src/gxhtbit.c">src/gxhtbit.c</a>,
<a href="../src/gxhttile.h">src/gxhttile.h</a>,
<a href="../src/gxhttype.h">src/gxhttype.h</a>,
<a href="../src/gzht.h">src/gzht.h</a>.

</dl>

<p>
Pattern colors (tiled patterns and shadings) each use a slightly different
approach from solid colors.

<p>
The device color for a tiled (PatternType 1) pattern contains a pointer to a
pattern instance, plus (for uncolored patterns) the device color to be
masked.  The pattern instance includes a procedure that actually paints the
pattern if the pattern is not in the cache.  For the PostScript interpreter,
this procedure returns an <b><tt>e_RemapColor</tt></b> exception code: this
eventually causes the interpreter to run the pattern's PaintProc, loading
the rendering into the cache, and then re-execute the original drawing
operator.

<dl>

<dt>
Patterns:
<dd>
<a href="../src/gspcolor.c">src/gspcolor.c</a>,
<a href="../src/gspcolor.h">src/gspcolor.h</a>,
<a href="../src/gsptype1.c">src/gsptype1.c</a>,
<a href="../src/gsptype1.h">src/gsptype1.h</a>,
<a href="../src/gxp1fill.c">src/gxp1fill.c</a>,
<a href="../src/gxp1impl.h">src/gxp1impl.h</a>,
<a href="../src/gxpcache.h">src/gxpcache.h</a>,
<a href="../src/gxpcmap.c">src/gxpcmap.c</a>,
<a href="../src/gxpcolor.h">src/gxpcolor.h</a>.

</dl>

<p>
The device color for a shading (PatternType 2) pattern also contains a
pointer to a pattern instance.  Shadings are not cached: painting with a
shading runs the shading algorithm every time.

<dl>

<dt>
Shading:
<dd>
<a href="../src/gsptype2.c">src/gsptype2.c</a>,
<a href="../src/gsptype2.h">src/gsptype2.h</a>,
<a href="../src/gsshade.c">src/gsshade.c</a>,
<a href="../src/gsshade.h">src/gsshade.h</a>,
<a href="../src/gxshade.c">src/gxshade.c</a>,
<a href="../src/gxshade.h">src/gxshade.h</a>,
<a href="../src/gxshade1.c">src/gxshade1.c</a>,
<a href="../src/gxshade4.c">src/gxshade4.c</a>,
<a href="../src/gxshade4.h">src/gxshade4.h</a>,
<a href="../src/gxshade6.c">src/gxshade6.c</a>.

</dl>

<p>
In addition to the PostScript graphics model, Ghostscript supports RasterOp,
a weak form of alpha channel, and eventually the full PDF 1.4 transparency
model.  The implemention of these facilities is quite slipshod and
scattered: only RasterOp is really implemented fully.  There is a general
compositing architecture, but it is hardly used at all, and in particular is
not used for RasterOp.  ****** TO BE COMPLETED ******

<dl>

<dt>
Compositing architecture:
<dd>
<a href="../src/gscompt.h">src/gscompt.h</a>,
<a href="../src/gxcomp.h">src/gxcomp.h</a>.

<dt>
RasterOp:
<dd>
<a href="../src/gdevdrop.c">src/gdevdrop.c</a>,
<a href="../src/gdevrops.c">src/gdevrops.c</a>,
<a href="../src/gsnorop.c">src/gsnorop.c</a>,
<a href="../src/gsrop.c">src/gsrop.c</a>,
<a href="../src/gsrop.h">src/gsrop.h</a>,
<a href="../src/gsropc.c">src/gsropc.c</a>,
<a href="../src/gsropc.h">src/gsropc.h</a>,
<a href="../src/gsropt.h">src/gsropt.h</a>,
<a href="../src/gsroptab.c">src/gsroptab.c</a>,
<a href="../src/gxdevrop.h">src/gxdevrop.h</a>,
<a href="../src/gxropc.h">src/gxropc.h</a>.

<dt>
Alpha channel and compositing:
<dd>
<a href="../src/gsalpha.c">src/gsalpha.c</a>,
<a href="../src/gsalpha.h">src/gsalpha.h</a>,
<a href="../src/gsalphac.c">src/gsalphac.c</a>,
<a href="../src/gsalphac.h">src/gsalphac.h</a>,
<a href="../src/gsdpnext.h">src/gsdpnext.h</a>,
<a href="../src/gxalpha.h">src/gxalpha.h</a>.

<dt>
Advanced transparency:
<dd>
<a href="../src/gstparam.h">src/gstparam.h</a>,
<a href="../src/gstrans.c">src/gstrans.c</a>,
<a href="../src/gstrans.h">src/gstrans.h</a>.

</dl>

<h4><a name="Other_graphics"></a>Other graphics</h4>

<dl>

<dt>
Miscellaneous graphics state:
<dd>
<a href="../src/gsclipsr.c">src/gsclipsr.c</a>,
<a href="../src/gsclipsr.h">src/gsclipsr.h</a>,
<a href="../src/gsdps.c">src/gsdps.c</a>,
<a href="../src/gsdps.h">src/gsdps.h</a>,
<a href="../src/gsdps1.c">src/gsdps1.c</a>,
<a href="../src/gsistate.c">src/gsistate.c</a>,
<a href="../src/gsline.c">src/gsline.c</a>,
<a href="../src/gsline.h">src/gsline.h</a>,
<a href="../src/gslparam.h">src/gslparam.h</a>,
<a href="../src/gsstate.c">src/gsstate.c</a>,
<a href="../src/gsstate.h">src/gsstate.h</a>,
<a href="../src/gstrap.c">src/gstrap.c</a>,
<a href="../src/gstrap.h">src/gstrap.h</a>,
<a href="../src/gxclipsr.h">src/gxclipsr.h</a>,
<a href="../src/gxistate.h">src/gxistate.h</a>,
<a href="../src/gxline.h">src/gxline.h</a>,
<a href="../src/gxstate.h">src/gxstate.h</a>,
<a href="../src/gzline.h">src/gzline.h</a>,
<a href="../src/gzstate.h">src/gzstate.h</a>.

</dl>

<h4><a name="Driver_support"></a>Driver support</h4>

<dl>

<dt>
Generic driver support:
<dd>
<a href="../src/gdevdcrd.c">src/gdevdcrd.c</a>,
<a href="../src/gdevdcrd.h">src/gdevdcrd.h</a>,
<a href="../src/gdevemap.c">src/gdevemap.c</a>,
<a href="../src/gsdevice.c">src/gsdevice.c</a>,
<a href="../src/gsdevice.h">src/gsdevice.h</a>,
<a href="../src/gsdparam.c">src/gsdparam.c</a>,
<a href="../src/gsxfont.h">src/gsxfont.h</a>,
<a href="../src/gxdevbuf.h">src/gxdevbuf.h</a>,
<a href="../src/gxdevcli.h">src/gxdevcli.h</a>,
<a href="../src/gxdevice.h">src/gxdevice.h</a>,
<a href="../src/gxrplane.h">src/gxrplane.h</a>,
<a href="../src/gxxfont.h">src/gxxfont.h</a>.

<dt>
Accessing rendered bits:
<dd>
<a href="../src/gdevdbit.c">src/gdevdbit.c</a>,
<a href="../src/gdevdgbr.c">src/gdevdgbr.c</a>,
<a href="../src/gxbitfmt.h">src/gxbitfmt.h</a>,
<a href="../src/gxgetbit.h">src/gxgetbit.h</a>.

<dt>
"Printer" driver support:
<dd>
<a href="../src/gdevppla.c">src/gdevppla.c</a>,
<a href="../src/gdevppla.h">src/gdevppla.h</a>,
<a href="../src/gdevprn.c">src/gdevprn.c</a>,
<a href="../src/gdevprn.h">src/gdevprn.h</a>,
<a href="../src/gdevprna.c">src/gdevprna.c</a>,
<a href="../src/gdevprna.h">src/gdevprna.h</a>,
<a href="../src/gxband.h">src/gxband.h</a>,
<a href="../src/gxpageq.c">src/gxpageq.c</a>,
<a href="../src/gxpageq.h">src/gxpageq.h</a>.

<dt>
High-level device support:
<dd>
<a href="../src/gdevvec.c">src/gdevvec.c</a>,
<a href="../src/gdevvec.h">src/gdevvec.h</a>.

<dt>
Banding:
<dd>
<a href="../src/gxclbits.c">src/gxclbits.c</a>,
<a href="../src/gxcldev.h">src/gxcldev.h</a>,
<a href="../src/gxclfile.c">src/gxclfile.c</a>,
<a href="../src/gxclimag.c">src/gxclimag.c</a>,
<a href="../src/gxclio.h">src/gxclio.h</a>,
<a href="../src/gxclist.c">src/gxclist.c</a>,
<a href="../src/gxclist.h">src/gxclist.h</a>,
<a href="../src/gxcllzw.c">src/gxcllzw.c</a>,
<a href="../src/gxclmem.c">src/gxclmem.c</a>,
<a href="../src/gxclmem.h">src/gxclmem.h</a>,
<a href="../src/gxclpage.c">src/gxclpage.c</a>,
<a href="../src/gxclpage.h">src/gxclpage.h</a>,
<a href="../src/gxclpath.c">src/gxclpath.c</a>,
<a href="../src/gxclpath.h">src/gxclpath.h</a>,
<a href="../src/gxclrast.c">src/gxclrast.c</a>,
<a href="../src/gxclread.c">src/gxclread.c</a>,
<a href="../src/gxclrect.c">src/gxclrect.c</a>,
<a href="../src/gxclutil.c">src/gxclutil.c</a>,
<a href="../src/gxclzlib.c">src/gxclzlib.c</a>.

</dl>

<h3><a name="Device_drivers"></a>Device drivers</h3>

<h4><a name="Internal_devices"></a>Internal devices</h4>

<p>
There are a number of "devices" that serve internal purposes.  Some of these
are meant to be real rendering targets; others are intended for use in
device pipelines.  The rendering targets are:

<dl>

<dt>
Memory devices:
<dd>
<a href="../src/gdevmem.c">src/gdevmem.c</a>,
<a href="../src/gdevmem.h">src/gdevmem.h</a>,
<a href="../src/gdevm1.c">src/gdevm1.c</a>,
<a href="../src/gdevm2.c">src/gdevm2.c</a>,
<a href="../src/gdevm4.c">src/gdevm4.c</a>,
<a href="../src/gdevm8.c">src/gdevm8.c</a>,
<a href="../src/gdevm16.c">src/gdevm16.c</a>,
<a href="../src/gdevm24.c">src/gdevm24.c</a>,
<a href="../src/gdevm32.c">src/gdevm32.c</a>,
<a href="../src/gdevmpla.c">src/gdevmpla.c</a>,
<a href="../src/gdevmpla.h">src/gdevmpla.h</a>,
<a href="../src/gdevmrop.h">src/gdevmrop.h</a>,
<a href="../src/gdevmr1.c">src/gdevmr1.c</a>,
<a href="../src/gdevmr2n.c">src/gdevmr2n.c</a>,
<a href="../src/gdevmr8n.c">src/gdevmr8n.c</a>,
<a href="../src/gsdevmem.c">src/gsdevmem.c</a>,
<a href="../src/gxdevmem.h">src/gxdevmem.h</a>.

<dt>
Alpha-related devices:
<dd>
<a href="../src/gdevabuf.c">src/gdevabuf.c</a>,
<a href="../src/gdevalph.c">src/gdevalph.c</a>.

<dt>
Other devices:
<dd>
<a href="../src/gdevdflt.c">src/gdevdflt.c</a>,
<a href="../src/gdevhit.c">src/gdevhit.c</a>,
<a href="../src/gdevht.c">src/gdevht.c</a>,
<a href="../src/gdevht.h">src/gdevht.h</a>,
<a href="../src/gdevmrun.c">src/gdevmrun.c</a>,
<a href="../src/gdevmrun.h">src/gdevmrun.h</a>,
<a href="../src/gdevplnx.c">src/gdevplnx.c</a>,
<a href="../src/gdevplnx.h">src/gdevplnx.h</a>,
<a href="../src/gxacpath.c">src/gxacpath.c</a>,
<a href="../src/gzacpath.h">src/gzacpath.h</a>.

</dl>

<p>
The forwarding devices meant for use in pipelines are:

<dl>

<dt>
The bounding box device:
<dd>
<a href="../src/gdevbbox.h">src/gdevbbox.h</a>,
<a href="../src/gdevbbox.c">src/gdevbbox.c</a>.

<dt>
Clipping devices:
<dd>
<a href="../src/gxclip.c">src/gxclip.c</a>,
<a href="../src/gxclip.h">src/gxclip.h</a>,
<a href="../src/gxclip2.c">src/gxclip2.c</a>,
<a href="../src/gxclip2.h">src/gxclip2.h</a>,
<a href="../src/gxclipm.c">src/gxclipm.c</a>,
<a href="../src/gxclipm.h">src/gxclipm.h</a>,
<a href="../src/gxmclip.c">src/gxmclip.c</a>,
<a href="../src/gxmclip.h">src/gxmclip.h</a>.

<dt>
Other devices:
<dd>
<a href="../src/gdevcmap.c">src/gdevcmap.c</a>,
<a href="../src/gdevcmap.h">src/gdevcmap.h</a>,
<a href="../src/gdevnfwd.c">src/gdevnfwd.c</a>.

</dl>

<h4><a name="High_level_devices"></a>High-level devices</h4>

<p>
The driver API includes high-level (path / image / text), mid-level
(polygon), and low-level (rectangle / raster) operations.  Most devices
implement only the low-level operations, and let generic code break down the
high-level operations.  However, some devices produce high-level output, and
therefore must implement the high-level operations.

<p>
Currently, the CGM driver is raster-only.  If anyone cares seriously about
CGM in the future, this driver should be upgraded to a higher level.

<dl>

<dt>
PostScript/PDF output device support:
<dd>
<a href="../src/gdevpsdf.h">src/gdevpsdf.h</a>,
<a href="../src/gdevpsdi.c">src/gdevpsdi.c</a>,
<a href="../src/gdevpsdp.c">src/gdevpsdp.c</a>,
<a href="../src/gdevpsds.c">src/gdevpsds.c</a>,
<a href="../src/gdevpsds.h">src/gdevpsds.h</a>,
<a href="../src/gdevpsdu.c">src/gdevpsdu.c</a>,
<a href="../src/gdevpsf.h">src/gdevpsf.h</a>,
<a href="../src/gdevpsf1.c">src/gdevpsf1.c</a>,
<a href="../src/gdevpsf2.c">src/gdevpsf2.c</a>,
<a href="../src/gdevpsfm.c">src/gdevpsfm.c</a>,
<a href="../src/gdevpsft.c">src/gdevpsft.c</a>,
<a href="../src/gdevpsfu.c">src/gdevpsfu.c</a>,
<a href="../src/gdevpsfx.c">src/gdevpsfx.c</a>.

<dt>
PostScript output device ([e]pswrite):
<dd>
b<a href="../src/gdevps.c">src/gdevps.c</a>,
<a href="../src/gdevpsu.c">src/gdevpsu.c</a>,
<a href="../src/gdevpsu.h">src/gdevpsu.h</a>.

<dt>
PDF output device (pdfwrite):
<dd>
<a href="../src/gdevpdf.c">src/gdevpdf.c</a>,
<a href="../src/gdevpdfb.c">src/gdevpdfb.c</a>,
<a href="../src/gdevpdfc.c">src/gdevpdfc.c</a>,
<a href="../src/gdevpdfd.c">src/gdevpdfd.c</a>,
<a href="../src/gdevpdfe.c">src/gdevpdfe.c</a>,
<a href="../src/gdevpdff.c">src/gdevpdff.c</a>,
<a href="../src/gdevpdff.h">src/gdevpdff.h</a>,
<a href="../src/gdevpdfg.c">src/gdevpdfg.c</a>,
<a href="../src/gdevpdfg.h">src/gdevpdfg.h</a>,
<a href="../src/gdevpdfi.c">src/gdevpdfi.c</a>,
<a href="../src/gdevpdfj.c">src/gdevpdfj.c</a>,
<a href="../src/gdevpdfm.c">src/gdevpdfm.c</a>,
<a href="../src/gdevpdfo.c">src/gdevpdfo.c</a>,
<a href="../src/gdevpdfo.h">src/gdevpdfo.h</a>,
<a href="../src/gdevpdfp.c">src/gdevpdfp.c</a>,
<a href="../src/gdevpdfr.c">src/gdevpdfr.c</a>,
<a href="../src/gdevpdft.c">src/gdevpdft.c</a>,
<a href="../src/gdevpdfu.c">src/gdevpdfu.c</a>,
<a href="../src/gdevpdfv.c">src/gdevpdfv.c</a>,
<a href="../src/gdevpdfw.c">src/gdevpdfw.c</a>,
<a href="../src/gdevpdfx.h">src/gdevpdfx.h</a>.

<dt>
PCL XL output device (pxlmono, pxlcolor):
<dd>
<a href="../src/gdevpx.c">src/gdevpx.c</a>,
<a href="../src/gdevpxat.h">src/gdevpxat.h</a>,
<a href="../src/gdevpxen.h">src/gdevpxen.h</a>,
<a href="../src/gdevpxop.h">src/gdevpxop.h</a>,
<a href="../src/gdevpxut.c">src/gdevpxut.c</a>,
<a href="../src/gdevpxut.h">src/gdevpxut.h</a>.

<dt>
Other high-level devices:
<dd>
<a href="../src/gdevtrac.c">src/gdevtrac.c</a>.

</dl>

<h4><a name="Other_maintained_drivers"></a>Other maintained drivers</h4>

<p>
The standard Ghostscript distribution includes a collection of drivers,
mostly written by Aladdin Enterprises, that are "maintained" in the same
sense as the Ghostscript core code.

<dl>

<dt>
Display drivers:
<dd>
<a href="../src/gdev8bcm.c">src/gdev8bcm.c</a>,
<a href="../src/gdev8bcm.h">src/gdev8bcm.h</a>,
<a href="../src/gdevegaa.asm">src/gdevegaa.asm</a>,
<a href="../src/gdevevga.c">src/gdevevga.c</a>,
<a href="../src/gdevl256.c">src/gdevl256.c</a>,
<a href="../src/gdevpccm.c">src/gdevpccm.c</a>,
<a href="../src/gdevpccm.h">src/gdevpccm.h</a>,
<a href="../src/gdevpcfb.c">src/gdevpcfb.c</a>,
<a href="../src/gdevpcfb.h">src/gdevpcfb.h</a>,
<a href="../src/gdevs3ga.c">src/gdevs3ga.c</a>,
<a href="../src/gdevsco.c">src/gdevsco.c</a>,
<a href="../src/gdevsvga.c">src/gdevsvga.c</a>,
<a href="../src/gdevsvga.h">src/gdevsvga.h</a>,
<a href="../src/gdevvglb.c">src/gdevvglb.c</a>.

<dt>
Window system drivers:
<dd>
<a href="../src/gdevmswn.c">src/gdevmswn.c</a>,
<a href="../src/gdevmswn.h">src/gdevmswn.h</a>,
<a href="../src/gdevmsxf.c">src/gdevmsxf.c</a>,
<a href="../src/gdevpm.c">src/gdevpm.c</a>,
<a href="../src/gdevpm.h">src/gdevpm.h</a>,
<a href="../src/gdevx.c">src/gdevx.c</a>,
<a href="../src/gdevx.h">src/gdevx.h</a>,
<a href="../src/gdevxalt.c">src/gdevxalt.c</a>,
<a href="../src/gdevxcmp.c">src/gdevxcmp.c</a>,
<a href="../src/gdevxcmp.h">src/gdevxcmp.h</a>,
<a href="../src/gdevxini.c">src/gdevxini.c</a>,
<a href="../src/gdevxres.c">src/gdevxres.c</a>,
<a href="../src/gdevxxf.c">src/gdevxxf.c</a>.

<dt>
Raster file output drivers:
<dd>
<a href="../src/gdevbit.c">src/gdevbit.c</a>,
<a href="../src/gdevbmp.c">src/gdevbmp.c</a>,
<a href="../src/gdevbmpa.c">src/gdevbmpa.c</a>,
<a href="../src/gdevcgm.c">src/gdevcgm.c</a>,
<a href="../src/gdevcgml.c">src/gdevcgml.c</a>,
<a href="../src/gdevcgml.h">src/gdevcgml.h</a>,
<a href="../src/gdevcgmx.h">src/gdevcgmx.h</a>,
<a href="../src/gdevfax.c">src/gdevfax.c</a>,
<a href="../src/gdevfax.h">src/gdevfax.h</a>,
<a href="../src/gdevjpeg.c">src/gdevjpeg.c</a>,
<a href="../src/gdevmiff.c">src/gdevmiff.c</a>,
<a href="../src/gdevpcx.c">src/gdevpcx.c</a>,
<a href="../src/gdevpbm.c">src/gdevpbm.c</a>,
<a href="../src/gdevpng.c">src/gdevpng.c</a>,
<a href="../src/gdevpsim.c">src/gdevpsim.c</a>,
<a href="../src/gdevtfax.c">src/gdevtfax.c</a>,
<a href="../src/gdevtfax.h">src/gdevtfax.h</a>,
<a href="../src/gdevtifs.c">src/gdevtifs.c</a>,
<a href="../src/gdevtifs.h">src/gdevtifs.h</a>,
<a href="../src/gdevtfnx.c">src/gdevtfnx.c</a>.

<dt>
Printer drivers:
<dd>

</dl>

<h4><a name="Contributed_drivers"></a>Contributed drivers</h4>

<h3><a name="PostScript_interpreter"></a>PostScript interpreter</h3>

<dl>

<dt>
Files:
<dd>
<a href="../src/interp.c">src/interp.c</a>,
<a href="../src/interp.h">src/interp.h</a>.

</dl>

<h4><a name="Main_program"></a>Main program</h4>

<p>
The main program of the interpreter is normally invoked from the command
line, but it has an API as well.  In fact, it has two APIs: one that
recognizes the existence of multiple "interpreter instances" (although it
currently provides a default instance, which almost all clients use), and a
completely different one designed for Windows DLLs.  These should be unified
as soon as possible, since there are two steadily growing incompatible
bodies of client code.

<dl>

<dt>
Files:
<dd>
<a href="../src/gs.c">src/gs.c</a>,
<a href="../src/gserver.c">src/gserver.c</a>,
<a href="../src/iccinit0.c">src/iccinit0.c</a>,
<a href="../src/iinit.c">src/iinit.c</a>,
<a href="../src/iinit.h">src/iinit.h</a>,
<a href="../src/imain.c">src/imain.c</a>,
<a href="../src/imain.h">src/imain.h</a>,
<a href="../src/imainarg.c">src/imainarg.c</a>,
<a href="../src/imainarg.h">src/imainarg.h</a>,
<a href="../src/iminst.h">src/iminst.h</a>,
<a href="../src/main.h">src/main.h</a>.

</dl>

<h4><a name="PostScript_interpreter_support"></a>Support</h4>

<p>
Memory management (refs, GC, save/restore) -- see <a
href="#PostScript_interpreter_extensions">below</a>.

<p>
Data structures (stacks, names, dicts, contexts)

<dl>

<dt>
General data structures:
<dd>
<a href="../src/icontext.c">src/icontext.c</a>,
<a href="../src/icontext.h">src/icontext.h</a>,
<a href="../src/icstate.h">src/icstate.h</a>,
<a href="../src/iddict.h">src/iddict.h</a>,
<a href="../src/idict.h">src/idict.h</a>,
<a href="../src/idict.c">src/idict.c</a>,
<a href="../src/idictdef.h">src/idictdef.h</a>,
<a href="../src/iname.c">src/iname.c</a>,
<a href="../src/iname.h">src/iname.h</a>,
<a href="../src/inamedef.h">src/inamedef.h</a>,
<a href="../src/inameidx.h">src/inameidx.h</a>,
<a href="../src/inames.h">src/inames.h</a>,
<a href="../src/inamestr.h">src/inamestr.h</a>,
<a href="../src/isdata.h">src/isdata.h</a>,
<a href="../src/istack.c">src/istack.c</a>,
<a href="../src/istack.h">src/istack.h</a>,
<a href="../src/istkparm.h">src/istkparm.h</a>.

<dt>
Specific stacks (dictionary, execution, operand):
<dd>
<a href="../src/dstack.h">src/dstack.h</a>,
<a href="../src/estack.h">src/estack.h</a>,
<a href="../src/iddstack.h">src/iddstack.h</a>,
<a href="../src/idsdata.h">src/idsdata.h</a>,
<a href="../src/idstack.c">src/idstack.c</a>,
<a href="../src/idstack.h">src/idstack.h</a>,
<a href="../src/iesdata.h">src/iesdata.h</a>,
<a href="../src/iestack.h">src/iestack.h</a>,
<a href="../src/iosdata.h">src/iosdata.h</a>,
<a href="../src/iostack.h">src/iostack.h</a>,
<a href="../src/ostack.h">src/ostack.h</a>.

<dt>
File implementation:
<dd>
<a href="../src/files.h">src/files.h</a>,
<a href="../src/zfile.c">src/zfile.c</a>,
<a href="../src/zfileio.c">src/zfileio.c</a>.

<dt>
Streams and filters:
<dd>
<a href="../src/ifilter.h">src/ifilter.h</a>,
<a href="../src/ifilter2.h">src/ifilter2.h</a>,
<a href="../src/ifrpred.h">src/ifrpred.h</a>,
<a href="../src/ifwpred.h">src/ifwpred.h</a>,
<a href="../src/istream.h">src/istream.h</a>,
<a href="../src/zfbcp.c">src/zfbcp.c</a>,
<a href="../src/zfdctd.c">src/zfdctd.c</a>,
<a href="../src/zfdcte.c">src/zfdcte.c</a>,
<a href="../src/zfdecode.c">src/zfdecode.c</a>,
<a href="../src/zfilter.c">src/zfilter.c</a>,
<a href="../src/zfilter2.c">src/zfilter2.c</a>,
<a href="../src/zfilterx.c">src/zfilterx.c</a>,
<a href="../src/zfmd5.c">src/zfmd5.c</a>,
<a href="../src/zfproc.c">src/zfproc.c</a>,
<a href="../src/zfrsd.c">src/zfrsd.c</a>,
<a href="../src/zfzlib.c">src/zfzlib.c</a>.

<dt>
Miscellaneous support:
<dd>
<a href="../src/errors.h">src/errors.h</a>,
<a href="../src/ghost.h">src/ghost.h</a>,
<a href="../src/iconf.c">src/iconf.c</a>,
<a href="../src/idparam.c">src/idparam.c</a>,
<a href="../src/idparam.h">src/idparam.h</a>,
<a href="../src/ilevel.h">src/ilevel.h</a>,
<a href="../src/inouparm.c">src/inouparm.c</a>,
<a href="../src/iparam.c">src/iparam.c</a>,
<a href="../src/iparam.h">src/iparam.h</a>,
<a href="../src/iparray.h">src/iparray.h</a>,
<a href="../src/iutil.c">src/iutil.c</a>,
<a href="../src/iutil.h">src/iutil.h</a>,
<a href="../src/iutil2.c">src/iutil2.c</a>,
<a href="../src/iutil2.h">src/iutil2.h</a>,
<a href="../src/iutilasm.asm">src/iutilasm.asm</a>.

</dl>

<h4><a name="Scanning_parsing"></a>Scanning/parsing</h4>

<dl>

<dt>
Files:
<dd>
<a href="../src/btoken.h">src/btoken.h</a>,
<a href="../src/ibnum.c">src/ibnum.c</a>,
<a href="../src/ibnum.h">src/ibnum.h</a>,
<a href="../src/inobtokn.c">src/inobtokn.c</a>,
<a href="../src/iscan.c">src/iscan.c</a>,
<a href="../src/iscan.h">src/iscan.h</a>,
<a href="../src/iscanbin.c">src/iscanbin.c</a>,
<a href="../src/iscanbin.h">src/iscanbin.h</a>,
<a href="../src/iscannum.c">src/iscannum.c</a>,
<a href="../src/iscannum.h">src/iscannum.h</a>,
<a href="../src/itoken.h">src/itoken.h</a>,
<a href="../src/scanchar.h">src/scanchar.h</a>,
<a href="../src/scantab.c">src/scantab.c</a>.

<h4><a name="Standard_operators"></a>Standard operators</h4>

<dt>
Operator support:
<dd>
<a href="../src/oparc.h">src/oparc.h</a>,
<a href="../src/opcheck.h">src/opcheck.h</a>,
<a href="../src/opdef.h">src/opdef.h</a>,
<a href="../src/oper.h">src/oper.h</a>,
<a href="../src/opextern.h">src/opextern.h</a>.

<dt>
Non-output-related operators:
<dd>
<a href="../src/ifunc.h">src/ifunc.h</a>,
<a href="../src/ivmem2.h">src/ivmem2.h</a>,
<a href="../src/zarith.c">src/zarith.c</a>,
<a href="../src/zarray.c">src/zarray.c</a>,
<a href="../src/zbseq.c">src/zbseq.c</a>,
<a href="../src/zcontext.c">src/zcontext.c</a>,
<a href="../src/zcontrol.c">src/zcontrol.c</a>,
<a href="../src/zdict.c">src/zdict.c</a>,
<a href="../src/zdosio.c">src/zdosio.c</a>,
<a href="../src/zdouble.c">src/zdouble.c</a>,
<a href="../src/zfunc.c">src/zfunc.c</a>,
<a href="../src/zfunc0.c">src/zfunc0.c</a>,
<a href="../src/zfunc3.c">src/zfunc3.c</a>,
<a href="../src/zfunc4.c">src/zfunc4.c</a>,
<a href="../src/zgeneric.c">src/zgeneric.c</a>,
<a href="../src/zmath.c">src/zmath.c</a>,
<a href="../src/zmatrix.c">src/zmatrix.c</a>,
<a href="../src/zmisc.c">src/zmisc.c</a>,
<a href="../src/zmisc1.c">src/zmisc1.c</a>,
<a href="../src/zmisc2.c">src/zmisc2.c</a>,
<a href="../src/zmisc3.c">src/zmisc3.c</a>,
<a href="../src/zpacked.c">src/zpacked.c</a>,
<a href="../src/zrelbit.c">src/zrelbit.c</a>,
<a href="../src/zstack.c">src/zstack.c</a>,
<a href="../src/zstring.c">src/zstring.c</a>,
<a href="../src/zsysvm.c">src/zsysvm.c</a>,
<a href="../src/ztoken.c">src/ztoken.c</a>,
<a href="../src/ztype.c">src/ztype.c</a>,
<a href="../src/zusparam.c">src/zusparam.c</a>,
<a href="../src/zvmem.c">src/zvmem.c</a>,
<a href="../src/zvmem2.c">src/zvmem2.c</a>.

<dt>
Device-related operators:
<dd>
<a href="../src/zdevcal.c">src/zdevcal.c</a>,
<a href="../src/zdevice.c">src/zdevice.c</a>,
<a href="../src/zdevice2.c">src/zdevice2.c</a>,
<a href="../src/ziodev.c">src/ziodev.c</a>,
<a href="../src/ziodev2.c">src/ziodev2.c</a>,
<a href="../src/ziodevs.c">src/ziodevs.c</a>,
<a href="../src/zmedia2.c">src/zmedia2.c</a>.

<dt>
Font and text related operators:
<dd>
<a href="../src/bfont.h">src/bfont.h</a>,
<a href="../src/ccfont.h">src/ccfont.h</a>,
<a href="../src/iccfont.c">src/iccfont.c</a>,
<a href="../src/icfontab.c">src/icfontab.c</a>,
<a href="../src/ichar.h">src/ichar.h</a>,
<a href="../src/ichar1.h">src/ichar1.h</a>,
<a href="../src/icharout.h">src/icharout.h</a>,
<a href="../src/icid.h">src/icid.h</a>,
<a href="../src/ifcid.h">src/ifcid.h</a>,
<a href="../src/ifont.h">src/ifont.h</a>,
<a href="../src/ifont1.h">src/ifont1.h</a>,
<a href="../src/ifont2.h">src/ifont2.h</a>,
<a href="../src/ifont42.h">src/ifont42.h</a>,
<a href="../src/zbfont.c">src/zbfont.c</a>,
<a href="../src/zcfont.c">src/zcfont.c</a>,
<a href="../src/zchar.c">src/zchar.c</a>,
<a href="../src/zchar1.c">src/zchar1.c</a>,
<a href="../src/zchar2.c">src/zchar2.c</a>,
<a href="../src/zchar32.c">src/zchar32.c</a>,
<a href="../src/zchar42.c">src/zchar42.c</a>,
<a href="../src/zcharout.c">src/zcharout.c</a>,
<a href="../src/zcharx.c">src/zcharx.c</a>,
<a href="../src/zcid.c">src/zcid.c</a>,
<a href="../src/zfcid.c">src/zfcid.c</a>,
<a href="../src/zfcid0.c">src/zfcid0.c</a>,
<a href="../src/zfcid1.c">src/zfcid1.c</a>,
<a href="../src/zfcmap.c">src/zfcmap.c</a>,
<a href="../src/zfont.c">src/zfont.c</a>,
<a href="../src/zfont0.c">src/zfont0.c</a>,
<a href="../src/zfont1.c">src/zfont1.c</a>,
<a href="../src/zfont2.c">src/zfont2.c</a>,
<a href="../src/zfont32.c">src/zfont32.c</a>,
<a href="../src/zfont42.c">src/zfont42.c</a>.

<dt>
Color, pattern, and halftone related operators:
<dd>
<a href="../src/icie.h">src/icie.h</a>,
<a href="../src/icolor.h">src/icolor.h</a>,
<a href="../src/icremap.h">src/icremap.h</a>,
<a href="../src/icsmap.h">src/icsmap.h</a>,
<a href="../src/iht.h">src/iht.h</a>,
<a href="../src/ipcolor.h">src/ipcolor.h</a>,
<a href="../src/zcie.c">src/zcie.c</a>,
<a href="../src/zcolor.c">src/zcolor.c</a>,
<a href="../src/zcolor1.c">src/zcolor1.c</a>,
<a href="../src/zcolor2.c">src/zcolor2.c</a>,
<a href="../src/zcrd.c">src/zcrd.c</a>,
<a href="../src/zcsdevn.c">src/zcsdevn.c</a>,
<a href="../src/zcsindex.c">src/zcsindex.c</a>,
<a href="../src/zcspixel.c">src/zcspixel.c</a>,
<a href="../src/zcssepr.c">src/zcssepr.c</a>,
<a href="../src/zhsb.c">src/zhsb.c</a>,
<a href="../src/zht.c">src/zht.c</a>,
<a href="../src/zht1.c">src/zht1.c</a>,
<a href="../src/zht2.c">src/zht2.c</a>,
<a href="../src/zpcolor.c">src/zpcolor.c</a>,
<a href="../src/zshade.c">src/zshade.c</a>,
<a href="../src/ztrans.c">src/ztrans.c</a>.

<dt>
Image-related operators:
<dd>
<a href="../src/iimage.h">src/iimage.h</a>,
<a href="../src/iimage2.h">src/iimage2.h</a>,
<a href="../src/zimage.c">src/zimage.c</a>,
<a href="../src/zimage2.c">src/zimage2.c</a>,
<a href="../src/zimage3.c">src/zimage3.c</a>.

<dt>
Other graphics-related operators:
<dd>
<a href="../src/igstate.h">src/igstate.h</a>,
<a href="../src/zdpnext.c">src/zdpnext.c</a>,
<a href="../src/zdps.c">src/zdps.c</a>,
<a href="../src/zdps1.c">src/zdps1.c</a>,
<a href="../src/zgstate.c">src/zgstate.c</a>,
<a href="../src/zpaint.c">src/zpaint.c</a>,
<a href="../src/zpath.c">src/zpath.c</a>,
<a href="../src/zpath1.c">src/zpath1.c</a>,
<a href="../src/zrop.c">src/zrop.c</a>,
<a href="../src/ztrap.c">src/ztrap.c</a>,
<a href="../src/zupath.c">src/zupath.c</a>.

</dl>

<h4><a name="Non_standard_operators"></a>Non-standard operators</h4>

<p>
The interpreter includes many non-standard operators.  Most of these provide
some part of the function of a standard operator, so that the standard
operator itself can be implemented in PostScript.  We don't document the
non-standard operators here, because the set changes frequently.  However,
all non-standard operators are supposed to have names that begin with '.',
so you can find them all by executing the following (Unix) command:

<blockquote><pre>
egrep '    [{]["].[.]' src/z*.c
</pre></blockquote>

<h4><a name="PostScript_code"></a>PostScript code</h4>

<p>
Resources

<p>
setpagedevice

<p>
Font loading

<p>
Encodings

<p>
Miscellaneous

<h3><a name="PDF_interpreter"></a>PDF interpreter</h3>

<p>
Ghostscript's PDF interpreter is written entirely in PostScript: until
recently, there was essentially no C code specifically for the purpose of
supporting PDF interpretation.  The one major exception is the PDF 1.4
transparency features, which we (but not Adobe) have made available to
PostScript code.

<p>
In addition to patching the <b><tt>run</tt></b> operator to detect PDF
files, the interpreter provides some procedures in <a
href="../lib/pdf_main.ps">lib/pdf_main.ps</a> that are meant to be called
from applications such as previewers.

<dl>

<dt>
Files:
<dd>
<a href="../lib/pdf_base.ps">lib/pdf_base.ps</a>,
<a href="../lib/pdf_draw.ps">lib/pdf_draw.ps</a>,
<a href="../lib/pdf_font.ps">lib/pdf_font.ps</a>,
<a href="../lib/pdf_main.ps">lib/pdf_main.ps</a>,
<a href="../lib/pdf_ops.ps">lib/pdf_ops.ps</a>,
<a href="../lib/pdf_sec.ps">lib/pdf_sec.ps</a>.

</dl>

<h3><a name="Build_support"></a>Build support</h3>

<p>
Ghostscript's build procedure is somewhat unusual in that it compiles and
then executes some support programs during the build process.  See the
individual programs for information about what they do.

<dl>

<dt>
Files:
<dd>
<a href="../src/bench.c">src/bench.c</a>,
<a href="../src/echogs.c">src/echogs.c</a>,
<a href="../src/genarch.c">src/genarch.c</a>,
<a href="../src/genconf.c">src/genconf.c</a>,
<a href="../src/gendev.c">src/gendev.c</a> (not used),
<a href="../src/genht.c">src/genht.c</a>,
<a href="../src/geninit.c">src/geninit.c</a>.

</dl>

<p>
There are also a number of programs, scripts, and configuration files that
exist only for the sake of the build process.

<dl>

<dt>
Files for PC environments:
<dd>
<a href="../src/bcc32.cfg">src/bcc32.cfg</a>,
<a href="../src/cp.bat">src/cp.bat</a>,
<a href="../src/cp.cmd">src/cp.cmd</a>,
<a href="../src/dw32c.def">src/dw32c.def</a>,
<a href="../src/dwmain.rc">src/dwmain.rc</a>,
<a href="../src/dwmain16.def">src/dwmain16.def</a>,
<a href="../src/dwmain32.def">src/dwmain32.def</a>,
<a href="../src/dwsetup.def">src/dwsetup.def</a>,
<a href="../src/dwsetup.rc">src/dwsetup.rc</a>,
<a href="../src/dwuninst.def">src/dwuninst.def</a>,
<a href="../src/dwuninst.rc">src/dwuninst.rc</a>,
<a href="../src/gs16spl.def">src/gs16spl.def</a>,
<a href="../src/gs16spl.rc">src/gs16spl.rc</a>,
<a href="../src/gsdll.c">src/gsdll.c</a>,
<a href="../src/gsdll.h">src/gsdll.h</a>,
<a href="../src/gsdll2.def">src/gsdll2.def</a>,
<a href="../src/gsdll2.rc">src/gsdll2.rc</a>,
<a href="../src/gsdll32.def">src/gsdll32.def</a>,
<a href="../src/gsdll32.rc">src/gsdll32.rc</a>,
<a href="../src/gsdll32w.lnk">src/gsdll32w.lnk</a>,
<a href="../src/gsdllos2.h">src/gsdllos2.h</a>,
<a href="../src/gsdllwin.h">src/gsdllwin.h</a>,
<a href="../src/gsgraph.icx">src/gsgraph.icx</a>,
<a href="../src/gsos2.def">src/gsos2.def</a>,
<a href="../src/gsos2.icx">src/gsos2.icx</a>,
<a href="../src/gsos2.rc">src/gsos2.rc</a>,
<a href="../src/gspmdrv.c">src/gspmdrv.c</a>,
<a href="../src/gspmdrv.h">src/gspmdrv.h</a>,
<a href="../src/gspmdrv.def">src/gspmdrv.def</a>,
<a href="../src/gspmdrv.icx">src/gspmdrv.icx</a>,
<a href="../src/gspmdrv.rc">src/gspmdrv.rc</a>,
<a href="../src/gstext.icx">src/gstext.icx</a>,
<a href="../src/gswin.rc">src/gswin.rc</a>,
<a href="../src/gswin32.rc">src/gswin32.rc</a>,
<a href="../src/gswin386.rc">src/gswin386.rc</a>,
<a href="../src/mv.bat">src/mv.bat</a>,
<a href="../src/mv.cmd">src/mv.cmd</a>,
<a href="../src/rm.bat">src/rm.bat</a>,
<a href="../src/rm.cmd">src/rm.cmd</a>,
<a href="../src/turboc.cfg">src/turboc.cfg</a>.

<dt>
Files for OpenVMS:
<dd>
<a href="../src/append_l.com">src/append_l.com</a>,
<a href="../src/copy_one.com">src/copy_one.com</a>,
<a href="../src/rm_all.com">src/rm_all.com</a>,
<a href="../src/rm_one.com">src/rm_one.com</a>.

<dt>
Other files:
<dd>
<a href="../src/ansi2knr.c">src/ansi2knr.c</a>,
<a href="../src/catmake">src/catmake</a>,
<a href="../src/ccgs">src/ccgs</a>,
<a href="../src/instcopy">src/instcopy</a>.

</dl>

<h3><a name="Utilities"></a>Utilities</h3>

<p>
Ghostscript comes with many utilities for doing things like viewing bitmap
files and converting between file formats.  Some of these are written in
PostScript, some as scripts, and some as scripts that invoke special
PostScript code.

<h4><a name="Utilities_in_PostScript"></a>Utilities in PostScript</h4>

<p>
These are all documented in <a href="Psfiles.htm">doc/Psfiles.htm</a>, q.v.

<h4><a name="Utility_scripts"></a>Utility scripts</h4>

<p>
Many of these scripts come in both Unix and MS-DOS (<b><tt>.bat</tt></b>
versions; some also have an OS/2 (<b><tt>.cmd</tt></b>) version.  The choice
of which versions are provided is historical and irregular.  These scripts
should all be documented somewhere, but currently, many of them have man
pages, a few have their own documentation in the doc directory, and some
aren't documented at all.

<dl>

<dt>
Script files without PC versions:
<dd>
<a href="../lib/afmdiff.awk">lib/afmdiff.awk</a>,
<a href="../lib/dvipdf">lib/dvipdf</a>,
<a href="../lib/fixmswrd.pl">lib/fixmswrd.pl</a>,
<a href="../lib/lprsetup.sh">lib/lprsetup.sh</a>,
<a href="../lib/pdf2dsc">lib/pdf2dsc</a>,
<a href="../lib/pfbtopfa">lib/pfbtopfa</a>,
<a href="../lib/pj-gs.sh">lib/pj-gs.sh</a>,
<a href="../lib/printafm">lib/printafm</a>,
<a href="../lib/pv.sh">lib/pv.sh</a>,
<a href="../lib/sysvlp.sh">lib/sysvlp.sh</a>,
<a href="../lib/unix-lpr.sh">lib/unix-lpr.sh</a>,
<a href="../lib/wftopfa">lib/wftopfa</a>.

<dt>
Script files with PC versions:
<dd>
<a href="../lib/bdftops">lib/bdftops</a>,
<a href="../lib/bdftops.bat">lib/bdftops.bat</a>,
<a href="../lib/bdftops.cmd">lib/bdftops.cmd</a>,
<a href="../lib/eps2eps">lib/eps2eps</a>,
<a href="../lib/eps2eps.bat">lib/eps2eps.bat</a>,
<a href="../lib/eps2eps.cmd">lib/eps2eps.cmd</a>,
<a href="../lib/font2c">lib/font2c</a>,
<a href="../lib/font2c.bat">lib/font2c.bat</a>,
<a href="../lib/font2c.cmd">lib/font2c.cmd</a>,
<a href="../lib/gsbj">lib/gsbj</a>,
<a href="../lib/gsbj.bat">lib/gsbj.bat</a>,
<a href="../lib/gsdj">lib/gsdj</a>,
<a href="../lib/gsdj.bat">lib/gsdj.bat</a>,
<a href="../lib/gsdj500">lib/gsdj500</a>,
<a href="../lib/gsdj500.bat">lib/gsdj500.bat</a>,
<a href="../lib/gslj">lib/gslj</a>,
<a href="../lib/gslj.bat">lib/gslj.bat</a>,
<a href="../lib/gslp">lib/gslp</a>,
<a href="../lib/gslp.bat">lib/gslp.bat</a>,
<a href="../lib/gsnd">lib/gsnd</a>,
<a href="../lib/gsnd.bat">lib/gsnd.bat</a>,
<a href="../lib/pdf2ps">lib/pdf2ps</a>,
<a href="../lib/pdf2ps.bat">lib/pdf2ps.bat</a>,
<a href="../lib/pdf2ps.cmd">lib/pdf2ps.cmd</a>,
<a href="../lib/pdfopt">lib/pdfopt</a>,
<a href="../lib/pdfopt.bat">lib/pdfopt.bat</a>,
<a href="../lib/pf2afm">lib/pf2afm</a>,
<a href="../lib/pf2afm.bat">lib/pf2afm.bat</a>,
<a href="../lib/pf2afm.cmd">lib/pf2afm.cmd</a>,
<a href="../lib/ps2ascii">lib/ps2ascii</a>,
<a href="../lib/ps2ascii.bat">lib/ps2ascii.bat</a>,
<a href="../lib/ps2ascii.cmd">lib/ps2ascii.cmd</a>,
<a href="../lib/ps2epsi">lib/ps2epsi</a>,
<a href="../lib/ps2epsi.bat">lib/ps2epsi.bat</a>,
<a href="../lib/ps2epsi.cmd">lib/ps2epsi.cmd</a>,
<a href="../lib/ps2pdf">lib/ps2pdf</a>,
<a href="../lib/ps2pdf.bat">lib/ps2pdf.bat</a>,
<a href="../lib/ps2pdf.cmd">lib/ps2pdf.cmd</a>,
<a href="../lib/ps2pdf12">lib/ps2pdf12</a>,
<a href="../lib/ps2pdf12.bat">lib/ps2pdf12.bat</a>,
<a href="../lib/ps2pdf12.cmd">lib/ps2pdf12.cmd</a>,
<a href="../lib/ps2pdf13">lib/ps2pdf13</a>,
<a href="../lib/ps2pdf13.bat">lib/ps2pdf13.bat</a>,
<a href="../lib/ps2pdf13.cmd">lib/ps2pdf13.cmd</a>,
<a href="../lib/ps2pdf14">lib/ps2pdf14</a>,
<a href="../lib/ps2pdf14.bat">lib/ps2pdf14.bat</a>,
<a href="../lib/ps2pdf14.cmd">lib/ps2pdf14.cmd</a>,
<a href="../lib/ps2pdfwr">lib/ps2pdfwr</a>,
<a href="../lib/ps2pdfxx.bat">lib/ps2pdfxx.bat</a>,
<a href="../lib/ps2ps">lib/ps2ps</a>,
<a href="../lib/ps2ps.bat">lib/ps2ps.bat</a>,
<a href="../lib/ps2ps.cmd">lib/ps2ps.cmd</a>.

<dt>
Script files with only PC versions:
<dd>
<a href="../lib/gsndt.bat">lib/gsndt.bat</a>,
<a href="../lib/gst.bat">lib/gst.bat</a>,
<a href="../lib/gstt.bat">lib/gstt.bat</a>,
<a href="../lib/lp386.bat">lib/lp386.bat</a>,
<a href="../lib/lp386r2.bat">lib/lp386r2.bat</a>,
<a href="../lib/lpgs.bat">lib/lpgs.bat</a>,
<a href="../lib/lpr2.bat">lib/lpr2.bat</a>,
<a href="../lib/pftogsf.bat">lib/pftogsf.bat</a>,
<a href="../lib/wmakebat.bat">lib/wmakebat.bat</a>.

</dl>

<hr>

<h2><a name="Memory_management"></a>Memory management</h2>

<h3><a name="Memory_manager_architecture"></a>Memory manager architecture</h3>

<p>
In many environments, the memory manager is a set of library facilities that
implicitly manage the entire address space in a homogenous manner.
Ghostscript's memory manager architecture has none of these properties:

<ul>

<li>Rather than a single library accessed as procedures, Ghostscript
includes multiple allocator types, each of which in turn may have multiple
instances (allocators).  Allocators are 'objects' with a substantial set of
virtual functions.

<li>Rather than managing the entire address space, each allocator manages a
storage pool, which it may or may not be able to expand or reduce by calling
on a 'parent' allocator.

<li>Rather than a single genus of untyped storage blocks, Ghostscript's
allocators provide two genera -- type-tagged 'objects', and 'strings' --
with substantially different properties.

</ul>

<h4><a name="Objects_vs_strings"></a>Objects vs strings</h4>

<p>
As noted above, allocators provide two different storage genera.

<p>
Objects:

<ul>
<li>Are aligned in storage to satisfy the most stringent alignment
requirement imposed by the CPU or compiler;
<li>Can be referenced only by pointers to their start, not to any internal
location, unless special arrangements are made;
<li>May contain pointers to other objects, or to strings;
<li>Have an associated <em>structure descriptor</em> that specifies their
size (usually) and the location of any pointers contained within them.
</ul>

<p>
Given a pointer to an object, the allocator that allocated it must be able
to return the object's size and the pointer to its structure descriptor.
(It is up to the client to know what allocator allocated an object.)

<p>
Strings:

<ul>
<li>Are not aligned in storage;
<li>Can be referenced by pointers (consisting of a starting address and a
length) to any substring, starting anywhere within the string;
<li>May not contain pointers;
<li>Do not have a structure descriptor.
</ul>

<p>
The object/string distinction reflects a space/capability tradeoff.  The
per-object space overhead of the standard type of allocator is typically 12
bytes; this is too much to impose on every string of a few bytes.  On the
other hand, restricting object pointers to reference the start of the object
currently makes object garbage collection and compaction more
space-efficient.  If we were to redesign the standard allocator, we would
probably opt for a different design in which strings were allocated within
container objects of a few hundred bytes, and pointers into the middle of
all objects were allowed.

<h4><a name="Structure_descriptors"></a>Structure descriptors</h4>

<p>
Every object has an associated structure descriptor, which the caller
provides when allocating the object.  The structure descriptor serves
several purposes:

<ul>
<li>Specifying the size of the object for allocation;
<li>Providing pointer-enumeration and pointer-relocation procedures for
the garbage collector;
<li>Providing an optional finalization procedure to be called when the
object is freed (either explicitly or automatically).
</ul>

<p>
Structure descriptors are read-only, and are normally allocated statically
using one of a large set of macros.

<p>
While the structure descriptor normally specifies the size of the object,
one can also allocate an array of bytes or objects, whose size is a multiple
of the size in the descriptor.  For this reason, every object stores its
size as well as a reference to its descriptor.

<p>
Because the standard Ghostscript garbage collector is conservative and can
move objects, every object must have an accurate structure descriptor.  If
you define a new type of object (structure) that will be allocated in
storage managed by Ghostscript, you <em>must</em> create an accurate
descriptor for it, and use that descriptor to allocate it.  The process of
creating accurate descriptors for all structures was long and painful, and
accounted for many hard-to-diagnose bugs.

<dl>
<dt>
Files:
<dd>
<a href="../src/gsstruct.h">src/gsstruct.h</a>,
<a href="../src/gsstype.h">src/gsstype.h</a>.
</dl>

<h4><a name="Garbage_collection"></a>Garbage collection</h4>

<p>
The allocator architecture is designed to support compacting garbage
collection.  Every object must be able to enumerate all the pointers it
contains, both for tracing and for relocation.  As noted just above, the
structure descriptor provides procedures that do this.

<p>
Whether or not a particular allocator type actually provides a garbage
collector is up to the allocator: garbage collection is invoked through a
virtual procedure.  In practice, however, there are only two useful garbage
collectors for Ghostscript's own allocator:

<ul>
<li>The "real" garbage collector associated withthe PostScript interpreter,
described <a href="#Interpreter_GC">below</a>;
<li>A "non" garbage collector that only merges adjacent free blocks.
</ul>

<dl>
<dt>
Files:
<dd>
<a href="../src/gsgc.h">src/gsgc.h</a>,
<a href="../src/gsnogc.c">src/gsnogc.c</a>,
<a href="../src/gsnogc.h">src/gsnogc.h</a>.
</dl>

<h4><a name="Movability"></a>Movability</h4>

<p>
As just noted, objects are normally movable by the garbage collector.
However, some objects must be immovable, usually because some other piece of
software must retain pointers to them.  The allocator API includes
procedures for allocating both movable (default) and immovable objects.
Note, however, that even immovable objects must be traceable (have a
structure descriptor), and may be freed, by the garbage collector.

<h4><a name="Parent_hierarchy"></a>Parent hierarchy</h4>

<p>
When an allocator needs to add memory to the pool that it manages, it
requests the memory from its <em>parent</em> allocator.  Every allocator has
a pointer to its parent; multiple allocators may share a single parent.  The
ultimate ancestor of all allocators that can expand their pool dynamically
is an allocator that calls <b><tt>malloc</tt></b>, described <a
href="#malloc">below</a>.  However, especially in embedded environments, an
allocator may be limited to a fixed-size pool assigned to it when it is
created.

<h4><a name="Allocator_API"></a>Allocator API</h4>

In summary, the allocator API provides the following principal operations:

<ul>
<li>Allocate and free movable (default) or immovable objects and strings.
<li>Return the structure type and size of an object.
<li>Resize (shrink or grow) movable objects and strings, preserving
the contents insofar as possible.
<li>Report the size of the managed pool, and how much of it is in use.
<li>Register and unregister root pointers for the garbage collector.
<li>Free the allocator itself.
<li>Consolidate adjacent free blocks to reduce fragmentation.
</ul>

<p>
For details, see <a href="../src/gsmemory.h">src/gsmemory.h</a>.

<p>
The allocator API also includes one special hook for the PostScript
interpreter: the concept of stable allocators.  See the section on <a
href="#save_forgetsave_restore"><b><tt>save</tt></b> and
<b><tt>restore</tt></b></a> below for details.

<dl>
<dt>
Files:
<dd>
<a href="../src/gsmemraw.h">src/gsmemraw.h</a>,
<a href="../src/gsmemory.c">src/gsmemory.c</a>,
<a href="../src/gsmemory.h">src/gsmemory.h</a>,
<a href="../src/gsstruct.h">src/gsstruct.h</a>,
<a href="../src/gsstype.h">src/gsstype.h</a>.
</dl>

<h3><a name="Freeing_storage"></a>Freeing storage</h3>

<p>
Ghostscript's memory management architecture provides three different ways
to free objects: explicitly, by reference counting, or by garbage
collection.  They provide different safety / performance / convenience
tradeoffs; we believe that all three are necessary.

<p>
Objects are always freed as a whole; strings may be freed piecemeal.

<p>
An object may have an associated finalization procedure, defined in the
structure descriptor.  This procedure is called just before the object is
freed, independent of which method is being used to free the object.  A few
types of objects have a virtual finalization procedure as well: the
finalization procedure defined in the descriptor simply calls the one in the
object.

<h4><a name="Explicit_freeing"></a>Explicit freeing</h4>

<p>
Objects and strings may be freed explicitly, using the
<b><tt>gs_free_</tt></b> virtual procedures in the allocator API.  It is up
to the client to ensure that all allocated objects are freed at most once,
and that there are no dangling pointers.

<p>
Explicit freeing is the fastest method, but is the least convenient and
least safe.  It is most appropriate when storage is freed in the same
procedure where it is allocated, or for storage that is known to be
referenced by only one pointer.

<h4><a name="Reference_counting"></a>Reference counting</h4>

<p>
Objects may be managed by reference counting.  When an object is allocated,
its reference count may be set to 0 or 1.  Subsequently, when the reference
count is decremented to 0, the object is freed.  Reference-counted objects
always have a virtual finalization procedure.

<p>
Reference counting is as fast as explicit freeing, but takes more space in
the object.  It is most appropriate for relatively large objects which are
referenced only from a small set of pointers.  Note that reference counting
cannot free objects that are involved in a pointer cycle (e.g., A -> B -> C
-> A).

<dl>
<dt>
Files:
<dd>
<a href="../src/gsrefct.h">src/gsrefct.h</a>.
</dl>

<h4><a name="Real_garbage_collection"></a>(Real) garbage collection</h4>

<p>
Objects and strings may be freed automatically by a garbage collector.  See
<a href="#Interpreter_GC">below</a>.

<h3><a name="Special_implementations"></a>Special implementations</h3>

<h4><a name="malloc"></a>malloc</h4>

<p>
As mentioned <a href="#Parent_hierarchy">above</a>, the ultimate ancestor of
all allocators with an expandable pool is one that calls
<b><tt>malloc</tt></b>.

<dl>
<dt>
Files:
<dd>
<a href="../src/gsmalloc.h">src/gsmalloc.h</a>,
<a href="../src/gsmalloc.c">src/gsmalloc.c</a>.
</dl>

<h4><a name="Locking"></a>Locking</h4>

<p>
In a multi-threaded environment, if an allocator must be callable from
multiple threads (for example, if it is used to allocate structures in one
thread that are passed to, and freed by, another thread), the allocator must
provide mutex protection.  Ghostscript provides this capability in the form
of a <em>wrapper</em> allocator, that simply forwards all calls to a
<em>target</em> allocator under protection of a mutex.  Using the wrapper
technique, any allocator can be made thread-safe.

<dl>
<dt>
Files:
<dd>
<a href="../src/gsmemlok.h">src/gsmemlok.h</a>,
<a href="../src/gsmemlok.c">src/gsmemlok.c</a>.
</dl>

<h4><a name="Retrying"></a>Retrying</h4>

<p>
In an embedded environment, job failure due to memory exhaustion is very
undesirable.  Ghostscript provides a wrapper allocator that, when an
allocation attempt fails, calls a client-provided procedure that can attempt
to free memory, then ask for the original allocation to be retried.  For
example, such a procedure can wait for a queue to empty, or can free memory
occupied by caches.

<dl>
<dt>
Files:
<dd>
<a href="../src/gsmemret.h">src/gsmemret.h</a>,
<a href="../src/gsmemret.c">src/gsmemret.c</a>.
</dl>

<h3><a name="Standard_implementation"></a>Standard implementation</h3>

<p>
The standard Ghostscript allocator gets storage from its parent (normally
the <b><tt>malloc</tt></b> allocator) in large blocks called
<em>chunks</em>, and then allocates objects up from the low end and strings
down from the high end.  Large objects or strings are allocated in their own
chunk.

<p>
The standard allocator maintains a set of free-block lists for small object
sizes, one list per size (rounded up to the word size), plus a free-block
list for large objects (but not for objects so large that they get their own
chunk: when such an object is freed, its chunk is returned to the parent).
The lists are not sorted; adjacent blocks are only merged if needed.

<p>
While the standard allocator implements the generic allocator API, and is
usable with the library alone, it includes a special hook for the PostScript
interpreter to aid in the efficient allocation of PostScript composite
objects (arrays and dictionaries).  See the section on <a
href="#Refs">Refs</a> below for details.

<dl>
<dt>
Files:
<dd>
<a href="../src/gsalloc.c">src/gsalloc.c</a>,
<a href="../src/gsalloc.h">src/gsalloc.h</a>,
<a href="../src/gxalloc.h">src/gxalloc.h</a>,
<a href="../src/gxobj.h">src/gxobj.h</a>.
</dl>

<h3><a name="PostScript_interpreter_extensions"></a>PostScript interpreter extensions</h3>

<p>
The PostScript interpreter uses an allocator that extends the graphic
library's standard allocator to handle PostScript objects,
<b><tt>save</tt></b> and <b><tt>restore</tt></b>, and real garbage
collection.

<h4><a name="Refs"></a>Refs (PostScript "objects")</h4>

<p>
Ghostscript represents what the PLRM calls PostScript "objects" using a
structure called a <b><tt>ref</tt></b>, defined in <a
href="../src/iref.h">src/iref.h</a>; packed refs, used for the elements of
packed arrays, are defined in <a href="../src/ipacked.h">src/ipacked.h</a>.
See those files for detailed information.

<dl>
<dt>
Files:
<dd>
<a href="../src/ipacked.h">src/ipacked.h</a>,
<a href="../src/iref.h">src/iref.h</a>.
</dl>

<p>
The PLRM calls for two types of "virtual memory" (VM) space: global and
local.  Ghostscript adds a third space, <em>system</em> VM, whose lifetime
is an entire session -- i.e., it is effectively "permanent".  All three
spaces are subject to garbage collection.  There is a separate allocator
instance for each VM space (actually, two instances each for global and
local spaces; see <a href="#save_forgetsave_restore">below</a>).  In a
system with multiple contexts and multiple global or local VMs, each global
or local VM has its own allocator instance(s).

<p>
Refs that represent PostScript composite objects, and therefore include
pointers to stored data, include a 2-bit VM space tag to indicate in which
VM the object data are stored.  In addition to system, global, and local VM,
there is a tag for "foreign" VM, which means that the memory is not managed
by a Ghostscript allocator at all.  Every store into a composite object must
check for <b><tt>invalidaccess</tt></b>: the VM space tag values are chosen
to help make this check efficient.  See <a
href="../src/ivmspace.h">src/ivmspace.h</a>, <a
href="../src/iref.h">src/iref.h</a>, and <a
href="../src/store.h">src/store.h</a> for details.

<dl>
<dt>
Files:
<dd>
<a href="../src/ivmspace.h">src/ivmspace.h</a>.
</dl>

<p>
PostScript composite objects (arrays and dictionaries) are usually small.
Using a separate memory manager object for each composite object would waste
a lot of space for object headers.  Therefore, the interpreter's memory
manager packs multiple composite objects (also called "ref-containing
objects") into a single memory manager object, similar to the way the memory
manager packs multiple objects into a chunk (see <a
href="#Standard_implementation">above</a>).  See <a
href="../src/gxalloc.h">src/gxalloc.h</a> for details.  This memory manager
object has a structure descriptor, like all other memory manager objects.

<p>
Note that the <b><tt>value.pdict</tt></b>, <b><tt>value.refs</tt></b>, or
<b><tt>value.packed</tt></b> member of a ref must point to a PostScript
composite object, and therefore can point into the middle of a memory
manager object.  This requires special handling by the garbage collector (<a
href="#Interpreter_GC">q.v.</a>).

<dl>
<dt>
Files:
<dd>
<a href="../src/ialloc.c">src/ialloc.c</a>,
<a href="../src/ialloc.h">src/ialloc.h</a>,
<a href="../src/iastate.h">src/iastate.h</a>,
<a href="../src/iastruct.h">src/iastruct.h</a>,
<a href="../src/ilocate.c">src/ilocate.c</a>,
<a href="../src/imemory.h">src/imemory.h</a>,
<a href="../src/istruct.h">src/istruct.h</a>.
</dl>

<h4><a name="save_forgetsave_restore"></a>save/.forgetsave/restore</h4>

<p>
In addition to <b><tt>save</tt></b> and <b><tt>restore</tt></b>, Ghostscript
provides a <b><tt>.forgetsave</tt></b> operator that makes things as though
a given <b><tt>save</tt></b> had never happened.  (In data base terminology,
<b><tt>save</tt></b> is "begin transaction", <b><tt>restore</tt></b> is
"abort transaction", and <b><tt>.forgetsave</tt></b> is "end/commit
transaction").  <b><tt>.forgetsave</tt></b> was implemented for a specific
commercial customer (who may no longer even be using it): it was a pain to
make work, but it's in the code now, and should be maintained.  See the
extensive comments in <a href="../src/isave.c">src/isave.c</a> for more
information about how these operations work.

<dl>
<dt>
Files:
<dd>
<a href="../src/idosave.h">src/idosave.h</a>,
<a href="../src/isave.c">src/isave.c</a>,
<a href="../src/isave.h">src/isave.h</a>,
<a href="../src/isstate.h">src/isstate.h</a>,
<a href="../src/store.h">src/store.h</a>.
</dl>

<h4><a name="Stable_allocators"></a>Stable allocators</h4>

<p>
Even though <b><tt>save</tt></b> and <b><tt>restore</tt></b> are concepts
from the PostScript interpreter, the generic allocator architecture and API
include a feature to support them, called <em>stable</em> allocators.  Every
allocator has an associated stable allocator, which tags pointers with the
same VM space number but which is not subject to <b><tt>save</tt></b> and
<b><tt>restore</tt></b>.  System VM is intrinsically stable (its associated
stable allocator is the same allocator), so there are only 5 allocators in
ordinary single-context usage: system VM, stable global VM, ordinary global
VM, stable local VM, ordinary local VM.

<p>
All PostScript objects are normally allocated with the non-stable
allocators.  The stable allocators should be used with care, since using
them can easily create dangling pointers: if storage allocated with a stable
allocator contains any references to PostScript objects, the client is
responsible for ensuring that the references don't outlive the referenced
objects, normally by ensuring that any such referenced objects are allocated
at the outermost <b><tt>save</tt></b> level.  (The original reason for
wanting stable allocators was the PostScript stacks, which are essentially
PostScript arrays but are not subject to <b><tt>save</tt></b> and
<b><tt>restore</tt></b>.)  For more examples, search the sources for
references to <b><tt>gs_stable_memory</tt></b>.

<h4><a name="Interpreter_GC"></a>Garbage collection</h4>

<p>
The interpreter's garbage collector is a compacting, non-conservative,
mark-and-sweep collector.

<ul>
<li>It compacts storage because that is the only way to avoid permanent
sandbars, which is essential in limited-memory environments.
<li>It is non-conservative because conservative collectors (which attempt
to determine whether arbitrary bit patterns are pointers) cannot compact.
<li>It uses mark-and-sweep, rather than a more modern copying approach,
because it cannot afford the extra memory required for copying.
</ul>

<p>
Roots for tracing must be registered with the allocator.  Most roots are
registered during initialization.

<p>
"Mark-and-sweep" is a bit of a misnomer.  The garbage collector actually has
5 main phases:

<ul>
<li>Sweep to clear marks;
<li>Trace and mark;
<li>Sweep to compute relocation;
<li>Sweep to relocate pointers;
<li>Sweep and compact.
</ul>

<p>
There is some extra complexity to handle collecting local VM only.  In this
case, all pointers in global VM are treated as roots, and global VM is not
compacted.

<p>
As noted above, PostScript arrays and strings can have refs that point
within them (because of <b><tt>getinterval</tt></b>).  Thus the garbage
collector must mark each element of an array, and even each byte of a
string, individually.  Specifically, it marks objects, refs, and strings
using 3 different mechanisms:

<ul>
<li>Objects have a mark bit in their header: see
<a href="../src/gxobj.h">src/gxobj.h</a>,
<li>Refs and packed refs have a reserved mark bit.
<li>Strings use a separate bit table, with one bit per string byte: see
<a href="../src/gxalloc.h">src/gxalloc.h</a>,
</ul>

<p>
Similarly, it records the relocation information for objects, refs, and
strings differently:

<ul>
<li>Objects record relocation in the object header.
<li>Refs record relocation in unused fields of refs such as nulls, which
don't use their <b><tt>value</tt></b> field.  Every memory manager object
that stores ref-containing objects as described above has an extra, unused
ref at the end for this purpose.
<li>Strings use a separate relocation table.
</ul>

<dl>
<dt>
Files:
<dd>
<a href="../src/igc.c">src/igc.c</a>,
<a href="../src/igc.h">src/igc.h</a>,
<a href="../src/igcref.c">src/igcref.c</a>,
<a href="../src/igcstr.c">src/igcstr.c</a>,
<a href="../src/igcstr.h">src/igcstr.h</a>,
<a href="../src/ireclaim.c">src/ireclaim.c</a>.
</dl>

<hr>

<h2><a name="Portability"></a>Portability</h2>

<p>
One of Ghostscript's most important features is its great portability across
platforms (CPUs, operating systems, compilers, and build tools).  The code
supports portability through two mechanisms:

<ul>

<li><a href="#Structural">Structural mechanisms</a> -- segregating
platform-dependent information into files in a particular way.

<li><a href="#Coding">Coding standards</a> -- avoiding relying on byte
order, scalar size, and platform-specific compiler or library features.

</ul>

<h3><a name="Structural"></a>Structural</h3>

<h4><a name="CPU_and_compiler"></a>CPU and compiler</h4>

<p>
Ghostscript attempts to discover characteristics of the CPU and compiler
automatically during the build process, by compiling and then executing a
program called <b><tt>genarch</tt></b>.  <b><tt>genarch</tt></b> generates a
file <b><tt>obj/arch.h</tt></b>, which almost all Ghostscript files then
include.  This works well for things like word size, byte order, and
floating point representation, but it can't determine whether or not a
compiler supports a particular feature, because if a feature is absent, the
compilation may fail.

<dl>
<dt>
Files:
<dd>
<a href="../src/genarch.c">src/genarch.c</a>,
<a href="../obj/arch.h">obj/arch.h</a>.
</dl>

<h4><a name="Library_headers"></a>Library headers</h4>

<p>
Despite the supposed standardization of ANSI C, platforms vary considerably
in where (and whether) they provide various standard library facilities.
Currently, Ghostscript's build process doesn't attempt to sort this out
automatically.  Instead, for each library header file
<b><tt>&lt;</tt></b><em>xxx</em><b><tt>.h&gt;</tt></b> there is a
corresponding Ghostscript source file
<b><tt>src/</tt></b><em>xxx</em><b><tt>_.h</tt></b>, containing a set of
compile-time conditionals that attempt to select the correct platform header
file, or in some cases substitute Ghostscript's own code for a missing
facility.  You may need to edit these files when moving to platforms with
unusually non-standard libraries.

<dl>
<dt>
Files:
<dd>
<a href="../src/close_.h">src/close_.h</a>,
<a href="../src/ctype_.h">src/ctype_.h</a>,
<a href="../src/dirent_.h">src/dirent_.h</a>,
<a href="../src/dos_.h">src/dos_.h</a>,
<a href="../src/errno_.h">src/errno_.h</a>,
<a href="../src/fcntl_.h">src/fcntl_.h</a>,
<a href="../src/jerror_.h">src/jerror_.h</a>,
<a href="../src/malloc_.h">src/malloc_.h</a>,
<a href="../src/math_.h">src/math_.h</a>,
<a href="../src/memory_.h">src/memory_.h</a>,
<a href="../src/pipe_.h">src/pipe_.h</a>,
<a href="../src/png_.h">src/png_.h</a>,
<a href="../src/stat_.h">src/stat_.h</a>,
<a href="../src/stdio_.h">src/stdio_.h</a>,
<a href="../src/string_.h">src/string_.h</a>,
<a href="../src/time_.h">src/time_.h</a>,
<a href="../src/vmsmath.h">src/vmsmath.h</a>,
<a href="../src/windows_.h">src/windows_.h</a>,
<a href="../src/x_.h">src/x_.h</a>.
</dl>

<p>
It has been suggested that the GNU 'configure' scripts do the above better,
for Unix systems, than Ghostscript's current methods.  While this may be
true, we have found configure scripts difficult to write, understand, and
maintain; and the 'autoconf' tool for generating configure scripts, which we
found easy to use, covers very little of the ground that Ghostscript
requires.

<h4><a name="Cross_platform_APIs"></a>Cross-platform APIs</h4>

<p>
For a few library facilities that are available on all platforms but are not
well standardized, or that may need to be changed for special environments,
Ghostscript defines its own APIs.  It is an architectural property of
Ghostscript that the implementations of these APIs are the only .c files
that are linked into an executable depending on the platform (as opposed to
depending on choices of drivers or optional features).

<dl>

<dt>
API:
<dd>
<a href="../src/gp.h">src/gp.h</a>,
<a href="../src/gpcheck.h">src/gpcheck.h</a>,
<a href="../src/gpgetenv.h">src/gpgetenv.h</a>,
<a href="../src/gpmisc.h">src/gpmisc.h</a>,
<a href="../src/gpsync.h">src/gpsync.h</a>.

<dt>
Implementation files shared among multiple platforms:
<dd>
<a href="../src/gp_getnv.c">src/gp_getnv.c</a>,
<a href="../src/gp_mktmp.c">src/gp_mktmp.c</a>,
<a href="../src/gp_nsync.c">src/gp_nsync.c</a>,
<a href="../src/gp_psync.c">src/gp_psync.c</a>,
<a href="../src/gp_strdl.c">src/gp_strdl.c</a>.
<a href="../src/gpmisc.c">src/gpmisc.c</a>,

<dt>
Platform-specific implementation files:
<dd>
<a href="../src/gp_dosfe.c">src/gp_dosfe.c</a>,
<a href="../src/gp_dosfs.c">src/gp_dosfs.c</a>,
<a href="../src/gp_dvx.c">src/gp_dvx.c</a>,
<a href="../src/gp_iwatc.c">src/gp_iwatc.c</a>,
<a href="../src/gp_msdos.c">src/gp_msdos.c</a>,
<a href="../src/gp_mshdl.c">src/gp_mshdl.c</a>,
<a href="../src/gp_msio.c">src/gp_msio.c</a>,
<a href="../src/gp_mslib.c">src/gp_mslib.c</a>,
<a href="../src/gp_mswin.c">src/gp_mswin.c</a>,
<a href="../src/gp_mswin.h">src/gp_mswin.h</a>,
<a href="../src/gp_ntfs.c">src/gp_ntfs.c</a>,
<a href="../src/gp_os2.c">src/gp_os2.c</a>,
<a href="../src/gp_os9.c">src/gp_os9.c</a>,
<a href="../src/gp_sysv.c">src/gp_sysv.c</a>,
<a href="../src/gp_unifn.c">src/gp_unifn.c</a>,
<a href="../src/gp_unifs.c">src/gp_unifs.c</a>,
<a href="../src/gp_unix.c">src/gp_unix.c</a>,
<a href="../src/gp_vms.c">src/gp_vms.c</a>,
<a href="../src/gp_wgetv.c">src/gp_wgetv.c</a>,
<a href="../src/gp_win32.c">src/gp_win32.c</a>,
<a href="../src/gp_wsync.c">src/gp_wsync.c</a>.

</dl>

<h4><a name="Makefiles"></a>Makefiles</h4>

<p>
Ghostscript's makefiles are structured very similarly to the cross-platform
library files.  The great majority of the makefiles are portable across all
platforms and all versions of <b><tt>make</tt></b>.  To achieve this, the
platform-independent makefiles must obey two constraints beyond those of the
POSIX <b><tt>make</tt></b> program:

<ul>

<li>No conditionals or <b><tt>include</tt></b>s are allowed.  While most
<b><tt>make</tt></b> programs now provide some form of conditional execution
and some form of inclusion, there is no agreement on the syntax.
(Conditionals and includes are allowed in platform-dependent makefiles; in
fact, an inclusion facility is required.)

<li>There must be a space on both sides of the : that separates the target
of a rule from its dependencies.  This is required for compatibility with
the OpenVMS <b><tt>MMS</tt></b> and <b><tt>MMK</tt></b> programs.

</ul>

<p>
The top-level makefile for each platform (where "platform" includes the OS,
the compiler, and the flavor of <b><tt>make</tt></b>) contains all the build
options, plus <b><tt>include</tt></b>s for the generic makefiles and any
platform-dependent makefiles that are shared among multiple platforms.

<p>
While most of the top-level makefiles build a PostScript and/or PDF
interpreter configuration, there are also a few makefiles that build a test
program that only uses the graphics library without any language
interpreter.  Among other things, this can be helpful in verifying that no
accidental dependencies on the interpreter have crept into the library or
drivers.

<p>
For families of similar platforms, the question arises whether to use
multiple top-level makefiles, or whether to use a single top-level makefile
that may require minor editing for some (or all) platforms.  Ghostscript
currently uses the following top-level makefiles for building interpreter
configurations:

<ul>

<li>Unix (including Linux):
<ul>
<li><a href="../src/unix-gcc.mak">src/unix-gcc.mak</a>,
for Unix with gcc.
<li><a href="../src/unixansi.mak">src/unixansi.mak</a>,
for Unix with an ANSI C compiler other than gcc.
<li><a href="../src/unixtrad.mak">src/unixtrad.mak</a>,
for Unix with a "traditional" or "K&amp;R" compiler.
</ul>

<li>PC:
<ul>
<li><a href="../src/bcwin32.mak">src/bcwin32.mak</a>,
for MS Windows with Borland C++ Builder.
<li><a href="../src/msvc32.mak">src/msvc32.mak</a>,
for MS Windows with Microsoft Visual C (MSVC).
<li><a href="../src/os2.mak">src/os2.mak</a>,
for MS-DOS or OS/2 GCC/EMX environment.
<li><a href="../src/watc.mak">src/watc.mak</a>,
for extended MS-DOS with Watcom C.
<li><a href="../src/watcw32.mak">src/watcw32.mak</a>,
for MS Windows with Watcom C.
</ul>

<li>Other:
<ul>
<li><a href="../src/all-arch.mak">src/all-arch.mak</a>,
for building on many Unix systems in a networked test environment.
<li><a href="../src/dvx-gcc.mak">src/dvx-gcc.mak</a>,
for DesqView/X with gcc.
<li><a href="../src/openvms.mak">src/openvms.mak</a>,
for OpenVMS with Digital's CC compiler and the MMS build program.
<li><a href="../src/openvms.mmk">src/openvms.mmk</a>,
for OpenVMS with Digital's CC compiler and the MMK build program.
</ul>

</ul>

<p>
The following top-level makefiles build the library test program:

<ul>
<li><a href="../src/ugcclib.mak">src/ugcclib.mak</a>,
on Unix with gcc.
<li><a href="../src/msvclib.mak">src/msvclib.mak</a>,
on MS Windows with MSVC.
<li><a href="../src/watclib.mak">src/watclib.mak</a>,
on extended MS-DOS with Watcom C.
</ul>

<p>
The MSVC makefiles may require editing to select between different versions
of MSVC, since different versions may have slightly incompatible command
line switches or customary installation path names.  The Unix makefiles
often require editing to deal with differing library path names and/or
library names.  For details, see <a href="Make.htm#Unix_build">the Unix
section</a> of the documentation for building Ghostscript.

<dl>

<dt>
Library test program:
<dd>
<a href="../src/gslib.c">src/gslib.c</a>.

<dt>
Platform-independent makefiles:
<dd>
<a href="../src/cfonts.mak">src/cfonts.mak</a>,
<a href="../src/contrib.mak">src/contrib.mak</a>,
<a href="../src/devs.mak">src/devs.mak</a>,
<a href="../src/gs.mak">src/gs.mak</a>,
<a href="../src/int.mak">src/int.mak</a>,
<a href="../src/jpeg.mak">src/jpeg.mak</a>,
<a href="../src/lib.mak">src/lib.mak</a>,
<a href="../src/libpng.mak">src/libpng.mak</a>,
<a href="../src/version.mak">src/version.mak</a>,
<a href="../src/wmin.mak">src/wmin.mak</a>,
<a href="../src/zlib.mak">src/zlib.mak</a>.

<dt>
Shared platform-dependent makefiles:
<dd>
<a href="../src/dvx-head.mak">src/dvx-head.mak</a>,
<a href="../src/dvx-tail.mak">src/dvx-tail.mak</a>,
<a href="../src/msvccmd.mak">src/msvccmd.mak</a>,
<a href="../src/msvctail.mak">src/msvctail.mak</a>,
<a href="../src/pcwin.mak">src/pcwin.mak</a>,
<a href="../src/unix-aux.mak">src/unix-aux.mak</a>,
<a href="../src/unix-end.mak">src/unix-end.mak</a>,
<a href="../src/unixhead.mak">src/unixhead.mak</a>,
<a href="../src/unixinst.mak">src/unixinst.mak</a>,
<a href="../src/unixlink.mak">src/unixlink.mak</a>,
<a href="../src/wccommon.mak">src/wccommon.mak</a>,
<a href="../src/wctail.mak">src/wctail.mak</a>,
<a href="../src/winint.mak">src/winint.mak</a>,
<a href="../src/winlib.mak">src/winlib.mak</a>,
<a href="../src/winplat.mak">src/winplat.mak</a>.

</dl>

<h3><a name="Coding"></a>Coding</h3>

<p>
Coding for portability requires avoiding both <em>explicit</em>
dependencies, such as platform-dependent <b><tt>#ifdef</tt></b>s, and
<em>implicit</em> dependencies, such as dependencies on byte order or the
size of the integral types.

<h4><a name="Explicit_dependencies"></a>Explicit dependencies</h4>

<p>
The platform-independent .c files never, ever, use <b><tt>#ifdef</tt></b> or
<b><tt>#if</tt></b> to select code for specific platforms.  Instead, we
always try to characterize some abstract property that is being tested.  For
example, rather than checking for macros that are defined on those specific
platforms that have 64-bit <b><tt>long</tt></b> values, we define a macro
<b><tt>ARCH_SIZEOF_LONG</tt></b> that can then be tested.  Such macros are
always defined in a .h file, either automatically in <b><tt>arch.h</tt></b>,
or explicitly in a <em>xxx</em><b><tt>_.h</tt></b> file, as described in
earlier sections.

<dl>
<dt>
Files:
<dd>
<a href="../src/std.h">src/std.h</a>,
<a href="../src/stdpre.h">src/stdpre.h</a>.
</dl>

<h4><a name="Implicit_dependencies"></a>Implicit dependencies</h4>

<p>
The most common source of byte ordering dependencies is casting between
types (T1 *) and (T2 *) where T1 and T2 are numeric types that aren't merely
signed/unsigned variants of each other.  To avoid this, the only casts
allowed in the code are between numeric types, from a pointer type to a long
integral type, and between pointer types.

<p>
Ghostscript's code assumes the following about the sizes of various types:

<dl>
<dt>char<dd>8 bits
<dt>short<dd>16 bits
<dt>int<dd>32 or 64 bits
<dt>long<dd>32 or 64 bits
<dt>float<dd>32 bits (may work with 64 bits)
<dt>double<dd>64 bits (may work with 128 bits)
</dl>

<p>
The code does not assume that the <b><tt>char</tt></b> type is signed (or
unsigned); except for places where the value is always a literal string, or
for interfacing to library procedures, the code uses <b><tt>byte</tt></b> (a
Ghostscript synonym for <b><tt>unsigned char</tt></b>) almost everywhere.

<p>
Pointers are signed on some platforms and unsigned on others.  In the few
places in the memory manager where it's necessary to reliably order-compare
(as opposed to equality-compare) pointers that aren't known to point to the
same allocated block of memory, the code uses the
<b><tt>PTR_</tt></b><em>relation</em> macros rather than direct comparisons.

<p>
See the files listed above for other situations where a macro provides
platform-independence or a workaround for bugs in specific compilers or
libraries (of which there are a distressing number).

<h4><a name="Platform_specific_code"></a>Platform-specific code</h4>

<p>
There are some features that are inherently platform-specific:

<ul>

<li>Microsoft Windows requires a lot of special top-level code, and also has
an installer and uninstaller.

<li>MacOS also requires special top-level code (not distributed with the
standard Ghostscript package).

</ul>

<dl>
<dt>
MS Windows files:
<dd>
<a href="../src/dpmainc.c">src/dpmainc.c</a>,
<a href="../src/dwdll.cpp">src/dwdll.cpp</a>,
<a href="../src/dwdll.h">src/dwdll.h</a>,
<a href="../src/dwimg.cpp">src/dwimg.cpp</a>,
<a href="../src/dwimg.h">src/dwimg.h</a>,
<a href="../src/dwinst.cpp">src/dwinst.cpp</a>,
<a href="../src/dwinst.h">src/dwinst.h</a>,
<a href="../src/dwmain.cpp">src/dwmain.cpp</a>,
<a href="../src/dwmain.h">src/dwmain.h</a>,
<a href="../src/dwmainc.cpp">src/dwmainc.cpp</a>,
<a href="../src/dwnodll.cpp">src/dwnodll.cpp</a>,
<a href="../src/dwsetup.cpp">src/dwsetup.cpp</a>,
<a href="../src/dwsetup.h">src/dwsetup.h</a>,
<a href="../src/dwtext.cpp">src/dwtext.cpp</a>,
<a href="../src/dwtext.h">src/dwtext.h</a>,
<a href="../src/dwuninst.cpp">src/dwuninst.cpp</a>,
<a href="../src/dwuninst.h">src/dwuninst.h</a>,
<a href="../src/gs16spl.c">src/gs16spl.c</a>.
</dl>

<hr>

<h2><a name="Adding_features_and_options"></a>Adding features and options</h2>

<p>
[Ray, please supply more information about what you want here]

<h2><a name="Troubleshooting"></a>Troubleshooting</h2>

<p>
The Ghostscript code has many tracing and debugging features that can be
enabled at run time using the <b><tt>-Z</tt></b> command line switch, if the
executable was compiled with <b><tt>DEBUG</tt></b> defined.  One
particularly useful combination is <b><tt>-Z@\?</tt></b>, which fills free
memory blocks with a pattern and also turns on run-time memory consistency
checking.  For more information, see <a
href="Use.htm#Debugging">doc/Use.htm#Debugging</a>; you can also search for
occurrences of <b><tt>if_debug</tt></b> or <b><tt>gs_debug_c</tt></b> in the
source code.  Note that many of these features are in the graphics library
and do not require a PostScript interpreter.

<p>
The code also contains many run-time procedures whose only purpose is to be
called from the debugger to print out various data structures, including all
the procedures in <a href="../src/idebug.c">src/idebug.c</a> (for the
PostScript interpreter) and the <b><tt>debug_dump_</tt></b> procedures in <a
href="../src/gsmisc.c">src/gsmisc.c</a>.

<dl>
<dt>
Files:
<dd>
<a href="Use.htm#Debugging">doc/Use.htm#Debugging</a>,
<a href="../src/gdebug.h">src/gdebug.h</a>,
<a href="../src/gsmdebug.h">src/gsmdebug.h</a>,
<a href="../src/idebug.h">src/idebug.h</a>,
<a href="../src/idebug.c">src/idebug.c</a>.
</dl>

<!-- [2.0 end contents] ==================================================== -->

<!-- [3.0 begin visible trailer] =========================================== -->
<hr>

<p>
<small>Copyright &copy; 2000 artofcode LLC.
All rights reserved.</small>

<p>
<small>This file is part of AFPL Ghostscript.  See the <a
href="Public.htm">Aladdin Free Public License</a> (the "License") for full
details of the terms of using, copying, modifying, and redistributing
AFPL Ghostscript.</small>

<p>
<small>Ghostscript version 6.60, 16 October 2000</small>

<!-- [3.0 end visible trailer] ============================================= -->

</body>
</html>
