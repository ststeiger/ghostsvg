%!PS-Adobe-2.0
%
%	 Copyright (C) 2002 artofcode LLC.	All rights reserved.
%
% This software is provided AS-IS with no warranty, either express or
% implied.
%
% This software is distributed under license and may not be copied,
% modified or distributed except as expressly authorized under the terms
% of the license contained in the file LICENSE in this distribution.
%
% For more information about licensing, please refer to
% http://www.ghostscript.com/licensing/. For information on
% commercial licensing, go to http://www.artifex.com/licensing/ or
% contact Artifex Software, Inc., 101 Lucas Valley Road #110,
% San Rafael, CA  94903, U.S.A., +1(415)492-9861.

% $Id$
% pdfread.ps - A procset for interpreting an ordered PDF 1.3 file.

% This module defines a simple error handler, which
% prints errors to page device. Also it defines a procedures
% for loading Ghostscript encoding files with
% a reference PS interpreter.

10 dict begin % A dictionary for local binding

/this currentdict def
/y 720 def
/ebuf 200 string def
/prnt {
  36 //this /y get moveto /Courier 12 selectfont //ebuf cvs show
  //this /y 2 copy get 12 sub put
} bind def

errordict /handleerror
{ systemdict begin
  $error begin
  newerror
  { (%%[ Error handled by opdfrerh.ps : ) print errorname //ebuf cvs print (; OffendingCommand: )
    print /command load //ebuf cvs print ( ]%%) = flush
    /newerror false store vmstatus pop pop 0 ne
    { grestoreall
    } if
    errorname (VMerror) ne
    { showpage
    } if
    initgraphics
    0 720 moveto
    errorname (VMerror) eq
    { //this /ehsave known
      { clear //this /ehsave get restore 2 vmreclaim
      } if
      vmstatus exch pop exch pop 
    }
    {
      (ERROR: ) //prnt exec errorname //prnt exec
      (OFFENDING COMMAND: ) //prnt exec
      /command load //prnt exec
      $error /ostack known {
        (%%[STACK:) =
        (STACK:) //prnt exec
        $error /ostack get aload length {
          dup = //prnt exec
        } repeat
      } if
    } ifelse
    //systemdict /showpage get exec
    (%%]%) =
  } if
  end
  end
} bind readonly put

end % A dictionary for local binding
/.findencoding { findencoding } bind def

/.registerencoding
{ pop pop
} bind def

/.defineencoding
{ Encs 3 1 roll put
} bind def

/findencoding
{ Encs exch get
} bind def

/Encs 20 dict def
Encs /StandardEncoding StandardEncoding put

/.dicttomark { >> } bind def

/.knownget 
{ 2 copy known {
    get true
  } {
    pop pop false
  } ifelse
} bind def

/.min 
{ 2 copy lt {
    exch
  } if
  pop
} bind def

/findresource
{ dup /Encoding eq {
    pop findencoding
  } {
    findresource
  } ifelse
} bind def

{
  /awidthshow
  { /Courier 12 selectfont awidthshow
  } bind def
} pop

{ % A temporary hack for debugging fonts
  /noaccess
  {
  } def
} pop

% CPSI doesn't love packed encodings, so disable packedarray for encoding files.
/packedarray 
{ array astore
} bind def
