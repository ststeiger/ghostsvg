<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"   "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Ghostscript change history (detailed)</title></title>
<!-- generated by split_changelog.py from the output of cvs2cl.pl -->
<!-- $Id$ -->
<link rel=stylesheet type="text/css" href="gs.css">
</head>
<body>

<p><strong><a name="2003-06-10_1429"></a>
2003-06-10 14:29 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix : (type 1 interpreter) : ce1_setcurrentpoint was wrong.
</pre>
<p>[src/gdevpsfx.c 1.18, src/gstype1.c 1.23]</p>
</blockquote>

<p><strong><a name="2003-06-09_2225"></a>
2003-06-09 22:25 Alex Cherepanov</strong></p>
<blockquote>
<pre>
Edited to reflect new capabilities of Bugzilla and current bug reporting
practices.
</pre>
<p>[doc/Bug-form.htm 1.37]</p>
</blockquote>

<p><strong><a name="2003-06-09_2216"></a>
2003-06-09 22:16 Alex Cherepanov</strong></p>
<blockquote>
<pre>
Change links from SourceForge bug tracker,
http://sourceforge.net/bugs/?group_id=1897
to Ghostscript Bugzilla, http://bugs.ghostscript.com
Fix bug #686888
</pre>
<p>[doc/Bug-info.htm 1.35, doc/Make.htm 1.67]</p>
</blockquote>

<p><strong><a name="2003-06-09_2155"></a>
2003-06-09 21:55 Alex Cherepanov</strong></p>
<blockquote>
<pre>
Add hyperlinks to Ghostscript Bugzilla bug entries.
</pre>
<p>[doc/Devices.htm 1.67, doc/Issues.htm 1.37, doc/Projects.htm 1.52]</p>
</blockquote>

<p><strong><a name="2003-06-09_1358"></a>
2003-06-09 13:58 Alex Cherepanov</strong></p>
<blockquote>
<pre>
Permit explicit specification of /GDBytes equal to 0 for incrementally
downloadable CIDFonts.
Fixes bug 686890 from customer 131.

DETAILS:
Incrementally downloadable CIDFont has GlyphDirectory key. According to
PLRM3 p. 376 "The binary data section of a CIDFont with a GlyphDirectory entry
does not need a charstring offset table or charstrings; if present, they will
be ignored". PLRM3 says nothing about GDBytes entry but it seems logical that
the entry is no longer needed when the structure it describes is ignored.

Old code used 0 as a default GDBytes value but required explicit specification
to be > 0. New code permits explicit 0 value because "Acrobat PDFMaker 5.0 for
Word" generates it.
</pre>
<p>[src/zfcid.c 1.14]</p>
</blockquote>

<p><strong><a name="2003-06-08_1359"></a>
2003-06-08 13:59 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix : Removing an unused code.
</pre>
<p>[src/gdevbit.c 1.8]</p>
</blockquote>

<p><strong><a name="2003-06-08_0330"></a>
2003-06-08 03:30 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix : Completing the extended semantics of gs_glyph.

DETAILS :

The extended semantics was introduced with the patch
http://www.ghostscript.com/pipermail/gs-cvs/2003-June/003354.html
That patch appears incomplete. Hopely this one completes it.
Also it fixes the bug #686910, which was not detected with comparefiles.
</pre>
<p>[src/zfont42.c 1.16]</p>
</blockquote>

<p><strong><a name="2003-06-07_2117"></a>
2003-06-07 21:17 Igor Melichev</strong></p>
<blockquote>
<pre>
pdfwrite : Write Encoding for True Type fonts.

DETAILS :

See comment in code.
</pre>
<p>[src/gdevpdtt.c 1.48]</p>
</blockquote>

<p><strong><a name="2003-06-07_2114"></a>
2003-06-07 21:14 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix (PDF interpreter) : Account Encoding while building CharStrings for TrueType fonts.

DETAILS :

If an Encoding is specified with a symbolic TrueType font,
its character names to be used for generating CharStrings.
The old code uses SymbolEncoding instead, missing some characters.

Fixes the bug 686912 "PDF interpreter problem with True Type & Encoding".
</pre>
<p>[lib/gs_ttf.ps 1.30, lib/pdf_font.ps 1.56]</p>
</blockquote>

<p><strong><a name="2003-06-06_1750"></a>
2003-06-06 17:50 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix (pdfwrite) : Convert Type 0 fonts with multiple CID font descendents into
Type 0 fonts with single CID font descendents (the part 3).

DETAILS :

At last we got a non-degenerate test for multiple CID font descendents
and could debug this stuff with a real document.

This patch mixes several changes :

- In some cases CIDFontType 2 fonts wrongly computed glyph indices ignoring GlyphDirectory.
  The new function z11_glyph_info works for it.

- The text decomposition in gdevpdtc.c mixed font indices of various font descendents.

- font->procs.get_glyph_info sometimes received glyph indices
  instead glyph names or CIDs. This happened with subglyphs of a CIDFontType 2 glyph.
  This patch improves the semantics of gs_glyph with distinguishing
  CIDs and GIDs with a new tag in the 2nd high order bit.
  The new macro GS_MAX_GLYPH_INDEX and related stuff
  works for it.

- gdevpdtd.c tried to compute CID font features using glyph names,
  which don't exist in this case. Replaced with CIDs.

- In gdevtrac.c a wrong glyph space was specified enumerating glyphs
  (a minor change, since gdevtrac.c is almost an example).

- Fixed a compiler warning in gdevdevn.c .

Working on this patch, we can see rudiments
in pdfwrite code, which are inherited from pre-8.00 code
(before stable font copies are implemented), which to be fixed someday :

- subset_glyphs arguments in gdevpsft.c looks always NULL
  and probably to be removed;

- COPY_GLYPH_BY_INDEX is now obsolete and to be removed;

- glyph enumeration procedures (*enumerate_glyph*) sometimes retrieve
  a wrong tag in gs_glyph values. The new macro GS_GLYPH_TAG works against it,
  rather an improvement to enumeration procedures would be useful.

The patch is debugged with korea.ps from the bug #686894.
After this change the embedded composite font with 2 CIDFontType 2
descendents is correctly decomposed into 2 Type 0 fonts with
single descendents (the old (gs8.10) code converts it into a Type 3
with outlines). The generated PDF satisfies the PDF specification
and Ghostscript can handle it. Meanwhile Acrobat Reader 4,5,6
fails with it. It appears an old known problem :
if a Type 42 font and a CIDFontType 2 with a non-standard CMap
appear in same PDF document, Acrobat Reader fails.
We believe it's a bug in Acrobat reader, because if we
modify the document with removing portions of text so that
only one of the 2 fonts is really used, Acrobat Reader renders it fine.
It fails only when both things are really used for rendering.
A workaround for this problem to do separately.
</pre>
<p>[src/gdevdevn.c 1.7, src/gdevpdtc.c 1.22, src/gdevpdtd.c 1.12, src/gdevpdtf.c 1.29, src/gdevpdtt.c 1.47, src/gdevpsf.h 1.24, src/gdevpsft.c 1.30, src/gdevpsfu.c 1.11, src/gdevtrac.c 1.5, src/gsccode.h 1.10, src/gstype42.c 1.31, src/gxfcopy.c 1.27, src/gxfont42.h 1.15, src/zfcid1.c 1.17, src/zfont42.c 1.15]</p>
</blockquote>

<p><strong><a name="2003-06-06_1629"></a>
2003-06-06 16:29 Alex Cherepanov</strong></p>
<blockquote>
<pre>
Process encryption dictionary after reading all parts of xref. Old code
resolved encryption dictionary after reading the latest part of xref only
and returned null instead of the dictionary for some files.
Fixes bug 686907 from customer 1060.
</pre>
<p>[lib/pdf_main.ps 1.75]</p>
</blockquote>

<p><strong><a name="2003-06-03_0731"></a>
2003-06-03 07:31 Igor Melichev</strong></p>
<blockquote>
<pre>
pdfwrite : Don't add subset prefix when a font doesn't embeed.
Ghostscript Bug 686893  NeverEmbed for Japanese CID fonts doesn't work correctly
Patch from Koji Nakamaru.
</pre>
<p>[src/gdevpdtf.c 1.28]</p>
</blockquote>

<p><strong><a name="2003-06-03_0626"></a>
2003-06-03 06:26 Dan Coby</strong></p>
<blockquote>
<pre>
Fix for 686785 segfault with PDF 1.4.  The PDF interpreter was calling
PDF 1.4 transparency features (begin_trasnparency_group) even though
the alpha involved was 1.0.  THe fix is to set a flag when the need
for transparency is done at the start of a page and then testing it
when transparency may be needed durng the page.
</pre>
<p>[lib/pdf_draw.ps 1.70, lib/pdf_main.ps 1.74]</p>
</blockquote>

<p><strong><a name="2003-06-03_0530"></a>
2003-06-03 05:30 Dan Coby</strong></p>
<blockquote>
<pre>
This fix corrects a recursion loop that exists with PDF form objects
with a transparency group.
</pre>
<p>[lib/pdf_draw.ps 1.69]</p>
</blockquote>

<p><strong><a name="2003-06-02_1952"></a>
2003-06-02 19:52 Alex Cherepanov</strong></p>
<blockquote>
<pre>
Count 1st page objects as shared objects. This is the 1st version that
generates files compatible with AR5 used as a browser plug-in.
Earlier versions of Acrobat ignore malformed hint tables. All versions
ignore the tables when they read the file from disk.
Fixes bug 592841
</pre>
<p>[lib/pdfopt.ps 1.20]</p>
</blockquote>

<p><strong><a name="2003-06-02_1621"></a>
2003-06-02 16:21 Igor Melichev</strong></p>
<blockquote>
<pre>
pdfwrite : Glyph indices were wrongly computed with copied FontType 11.
Ghostscript Bug 686894 "Corrupted CMap".
</pre>
<p>[src/gxfcopy.c 1.26]</p>
</blockquote>

<p><strong><a name="2003-06-02_1335"></a>
2003-06-02 13:35 Ralph Giles</strong></p>
<blockquote>
<pre>
Add standard banner and (unnecessary) double include protection to satisfy policy tests.
</pre>
<p>[src/macos_carbon_pre.h 1.2]</p>
</blockquote>

<p><strong><a name="2003-06-02_1329"></a>
2003-06-02 13:29 Ralph Giles</strong></p>
<blockquote>
<pre>
Correct listing of MacOS platform-specific source files.
</pre>
<p>[doc/Develop.htm 1.116]</p>
</blockquote>

<p><strong><a name="2003-05-31_0010"></a>
2003-05-31 00:10 Ray Johnston</strong></p>
<blockquote>
<pre>
Previous commit was from a bad version of the file (prior to a local
correction in a different directory). This fix is the correct fix for
embedded fonts that have Length 0 for customer #590.
</pre>
<p>[lib/pdf_font.ps 1.55]</p>
</blockquote>

<p><strong><a name="2003-05-30_2328"></a>
2003-05-30 23:28 Ray Johnston</strong></p>
<blockquote>
<pre>
Some PDF files have embedded fonts with Length == 0. These should default
to the same handling as when there is no embedded font. Fix for customer
#590.
</pre>
<p>[lib/pdf_font.ps 1.54]</p>
</blockquote>

<p><strong><a name="2003-05-29_1928"></a>
2003-05-29 19:28 Ralph Giles</strong></p>
<blockquote>
<pre>
Add an example library client for MacOS, comparable to dxmain and dwmain for other platforms. This
implementation is specific to Metrowerk CodeWarrior, relying on the MSL/SIOUX stdio implementation
for the interactive window. No project file support at the moment.

Code contributed by Nigel Hathaway.
</pre>
<p>[src/dmmain.c 1.1, src/dmmain.r 1.1]</p>
</blockquote>

<p><strong><a name="2003-05-29_1911"></a>
2003-05-29 19:11 Ralph Giles</strong></p>
<blockquote>
<pre>
Add a prefix header file for the MacOS Carbon build to enable target-specific settings.

DETAILS:

Metrowerks CodeWarrior doesn't really have an equivalent of the -D commandline option to set CPP
defines at compile time. This makes it difficult to set target-specific #ifdef's, for example the
__CARBON__ switches used in the MacOS support code. The closest thing offered is a hook in the
project file for a 'prefix' header file that will be prepended to each source file as it is fed to
the preprocessor. We add such a file for the carbon build, and enable it in the project file xml.

The conditional in macgenmcpxml.sh is a direct comparison for the Ghostscript carbon shlib name,
which is excessively brittle. Something like perl's =~ /carbon/i on the target name would be
preferable, but I couldn't figure out how to do that reliably in sh.
</pre>
<p>[src/macgenmcpxml.sh 1.10, src/macos_carbon_pre.h 1.1]</p>
</blockquote>

<p><strong><a name="2003-05-29_1902"></a>
2003-05-29 19:02 Ralph Giles</strong></p>
<blockquote>
<pre>
Check for a valid filter name before trying to parse jbig2 global context streams.
Fixes bug 686829.

DETAILS:

The expansion of abbreviated filter names and check for supported filters was
happening after the special-case handling of JBIG2Decode parameters, resulting
is an '/undefined in /.jbig2makeglobalctx' error if Ghostscript was compiled
without jbig2 support, rather than the usual 'Unable to process' warnings for
files containing JBIG2Decode data.
</pre>
<p>[lib/pdf_base.ps 1.38]</p>
</blockquote>

<p><strong><a name="2003-05-29_1638"></a>
2003-05-29 16:38 Ralph Giles</strong></p>
<blockquote>
<pre>
Remove spurious '-c' options to install. Closes bug 686895.
</pre>
<p>[ijs/Makefile.in 1.2]</p>
</blockquote>

<p><strong><a name="2003-05-27_1610"></a>
2003-05-27 16:10 Alex Cherepanov</strong></p>
<blockquote>
<pre>
Initialize current color value as null when pattern color space is set.
Fixes bug 686805
</pre>
<p>[src/zpcolor.c 1.10]</p>
</blockquote>

<p><strong><a name="2003-05-24_2241"></a>
2003-05-24 22:41 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix : Don't fail when GlyphNames2Unicode can't be provided for a CID font.
</pre>
<p>[lib/gs_fntem.ps 1.6]</p>
</blockquote>

<p><strong><a name="2003-05-24_1719"></a>
2003-05-24 17:19 Dan Coby</strong></p>
<blockquote>
<pre>
A pair of fixes for Bug 686791   Device bitcmyk produces wrong output
The bitcmyk device produce the wrong output if GrayValues=8.  In this
case the pixel size is 32 bits.  The encode_color procedure was sign
extending the  MSB into the upper 32 bits of 64 bit gx_color_indexes.
The fix in gdevbit.c prevents this from happening.  The fix in gdevm32.c
makes it so that it does not matter.  I am including both for
completeness.  The bitcmyk device should not produce garbage in the
remaining bits.  Thus the first fix.  However there may be other
devices with this problem so I am including the fix in gdevm32.c.
There was a recent report from an AIX system with a similar problem
</pre>
<p>[src/gdevbit.c 1.7, src/gdevm32.c 1.5]</p>
</blockquote>

<p><strong><a name="2003-05-23_0957"></a>
2003-05-23 09:57 Igor Melichev</strong></p>
<blockquote>
<pre>
Provide a trial support for converting a text to Unicode.
</pre>
<p>[lib/gs_cidfn.ps 1.27, lib/gs_fntem.ps 1.5, lib/gs_fonts.ps 1.30, lib/gs_pdfwr.ps 1.33, src/gdevpdtc.c 1.21, src/zbfont.c 1.19]</p>
</blockquote>

<p><strong><a name="2003-05-23_0153"></a>
2003-05-23 01:53 Ray Johnston</strong></p>
<blockquote>
<pre>
Stream 'position' was not update correctly under some conditions.
Fixes Bug #686859 for customer #600.

DETAILS:

The stream position was not updated if the buffer was emptied by
sgets, which then called to spgetcc. The latter would reset the
read pointers needed in order to account for the empty buffer.
</pre>
<p>[src/stream.c 1.22]</p>
</blockquote>

<p><strong><a name="2003-05-22_2337"></a>
2003-05-22 23:37 Igor Melichev</strong></p>
<blockquote>
<pre>
pdfwrite : Convert Type 0 fonts with multiple CID font descendents into
Type 0 fonts with single CID font descendents (part 2).

DETAILS :

The previous patch appears wrong for the case when same CID font is used with
different CMaps. Creating multiple Type 0 fonts for this case,
assigning them a composite font name with CMap name.

Minor changes :

- a compiler warning in gdevpdfv.c .

- a wrong error code was returned from zfcid0.c .
</pre>
<p>[src/gdevpdfv.c 1.26, src/gdevpdtc.c 1.20, src/gdevpdtf.c 1.27, src/gdevpdtf.h 1.18, src/gdevpdtt.c 1.46, src/gdevpdtt.h 1.17, src/zfcid0.c 1.20]</p>
</blockquote>

<p><strong><a name="2003-05-22_2257"></a>
2003-05-22 22:57 Ralph Giles</strong></p>
<blockquote>
<pre>
Double-equals ('==') for string comparison is not portable shell. Thanks
to Nelson Beebe for pointing out the issue.
</pre>
<p>[src/configure.ac 1.29]</p>
</blockquote>

<p><strong><a name="2003-05-22_2027"></a>
2003-05-22 20:27 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix : Removed a debug hack.
</pre>
<p>[src/gsfcmap1.c 1.6]</p>
</blockquote>

<p><strong><a name="2003-05-22_1551"></a>
2003-05-22 15:51 Ray Johnston</strong></p>
<blockquote>
<pre>
PDF Forms that contained indirect objects need to be resolved prior to
processing with 'execform'. Bug #686884 for customer #150.
</pre>
<p>[lib/pdf_draw.ps 1.68]</p>
</blockquote>

<p><strong><a name="2003-05-22_1541"></a>
2003-05-22 15:41 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix (pdfwrite) : Convert Type 0 fonts with multiple CID font descendents into
Type 0 fonts with single CID font descendents.

DETAILS :

Bug 686869 "Rasterized characters".

Our testbase doesn't test this case. Rather the test file for 686869
contains a font with 2 CID descendents, it actually uses only the 1st
descendent, so it's not a complete test.

The new code fails with 401-01.ps . This test file is buggy and
requires a special workaround, which should be a separate patch.

The main change is gdevpdtc.c, gdevpdtf.h .

Minor changes :

- added a new argument to a set of CMap management functions to access a
  submap corresponding to a specified font index;

- gs_cmap_init now reserves so many gs_id numbers,
  as many fonts it refer;

- removed some unused variables (gdevpdfm.c, gdevpdfv.c, gdevpdtb.c).
</pre>
<p>[src/gdevpdfm.c 1.31, src/gdevpdfv.c 1.25, src/gdevpdtb.c 1.19, src/gdevpdtc.c 1.19, src/gdevpdtf.c 1.26, src/gdevpdtf.h 1.17, src/gdevpdtt.c 1.45, src/gdevpdtt.h 1.16, src/gdevpdtw.c 1.18, src/gdevpdtw.h 1.3, src/gdevpsf.h 1.23, src/gdevpsfm.c 1.14, src/gsfcmap.c 1.22, src/gxfcmap.h 1.15, src/zcidtest.c 1.3]</p>
</blockquote>

<p><strong><a name="2003-05-22_0602"></a>
2003-05-22 06:02 Igor Melichev</strong></p>
<blockquote>
<pre>
Fix (pdfwrite) : Removing the 'vdata' argument to simplify internal interfaces.

DETAILS :

This change is algorithmically equivalent.

Note that 'size' argument is replaced with 'bsize', which now passes the
buffer size rather than text size. Added some dynamical checks to ensure the
buffer size is enough.
</pre>
<p>[src/gdevpdtc.c 1.18, src/gdevpdte.c 1.36, src/gdevpdtt.c 1.44, src/gdevpdtt.h 1.15]</p>
</blockquote>

<p><strong><a name="2003-05-21_1750"></a>
2003-05-21 17:50 Ralph Giles</strong></p>
<blockquote>
<pre>
Bump version number after the 8.10 release.
</pre>
<p>[doc/News.htm 1.130, lib/gs_init.ps 1.91, src/gscdef.c 1.36, src/version.mak 1.63]</p>
</blockquote>
</body>
</html>
